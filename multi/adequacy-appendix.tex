
\begin{center}
 \textsc{Adequacy Proofs}
\end{center}
\label{sec:adequacy-long}

The following lemma is helpful for many adequacy proofs.  It says that
for many mode theories 0-use variables can be strengthened away.  

\begin{lemma}[0-use Strengthing] \label{lem:0-use-strengthening}
We say that a formula $\F{\alpha}{\Delta}$ and \U{c.\alpha}{\Delta}{A}
is relevant if every variable from $\Delta$ (and $c$ for \Usymb) occurs
at least once in $\alpha$.

Suppose the mode theory has the property that for all $x$, $\alpha$,
$\beta$, if $\alpha \spr \beta$ and $x \# \alpha$ then $x \# \beta$ (in
particular, equations must have the same variables on both sides).
Suppose additionally a sequent \seq{\Gamma}{\alpha}{A} such that every
\Fsymb/\Usymb\/ subformula of $\Gamma,A$ is relevant.

Then if $\D :: \seq{\Gamma}{\alpha}{A}$ and $\vec{x}$ are variables such
that $\vec{x} \# \alpha$ then there is a $\D' ::
\seq{\Gamma-\vec{x}}{\alpha}{A}$ and $size(\D') \le size(\D)$.
\end{lemma}

\begin{proof}
The proof is by induction on $\D$.  In all cases, the assumption that
every formula is relevant is preserved for all premises of a rule by the
subformula property.

\begin{itemize}
\item In the case for a variable $x:P$ with transformation $\beta \spr
  x$, we need to show that the variable $x$ being used is not one of the
  ones being strengthened away.  But if $x$ were in $\vec{x}$, then we
  would have $x \# \beta$, and therefore by the assumption, $x \# x$, a
  contradiction.  Therefore $x \in {\Gamma-\vec{x}}$, and we can reapply
  the variable rule, which has the same size.

\item In the case for \FR, we have $\vec{x} \# \beta$, so by the
  reduction condition, $\vec{x} \# \alpha[\gamma]$.  By the relevance
  condition, all variables that $\gamma$ substitutes occur in $\alpha$,
  which means each component of $\gamma$ occurs in $\alpha[\gamma]$.
  Therefore $\vec{x} \# \gamma$.  We can use the inductive hypothesis to
  obtain a no-bigger derivation of \seq{\Gamma-\vec{x}}{\gamma}{\Delta},
  and then reapply \FR.

\item In the case for \FL, we distinguish cases on whether $x \in
  \vec{x}$ or not.

  If it is, then this is an elimination on a 0-use variable that we
  would like to drop.  Because $x \# \beta$, $\beta[\alpha/x] = \beta$,
  and note that $\Delta \# \beta$ because it occurs only in $\alpha$.
  Thus, if we appeal to the inductive hypothesis on the premise with
  $\vec{x}-x,\Delta$, we get
  \seq{(\Gamma,\Gamma',\Delta)-(\vec{x}-x,\Delta)}{\beta}{C}, 
  i.e.
  \seq{\Gamma,x:\F{\alpha}{\Delta},\Gamma',-\vec{x}}{\beta}{C}
  as desired.  That is, we recursively drop all variables that came from
  the elimination, in addition to any others that we were trying to drop
  besides $\vec{x}$.  

  If it is not, then $\vec{x} \# \beta$ and $\vec{x} \# \alpha$ (by
  scoping) implies $\vec{x} \# \beta[\alpha/x]$, so by the inductive
  hypothesis we get a no-bigger derivation of
  \seq{\Gamma,\Gamma'-\vec{x},\Delta}{\beta[\alpha/x]}{C}, and we can
  reapply \FL (because the principal variable $x$ of the left rule is
  not removed).

\item In the case for \UR, we have $\vec{x}$ a collection of variables
  bound in $\Gamma$, so $\vec{x} \# \alpha$ (since the domain of
  $\alpha$ is not $\Gamma$) in addition to $\vec{x} \# \beta$.  Thus
  $\vec{x} \# \alpha{\beta}{x}$, so the inductive hypothesis gives a
  no-bigger derivation of
  \seq{\Gamma-\vec{x},\Delta}{\alpha[\beta/x]}{A}, and we can reapply
  the rule.

\item In the case for \UL, we distinguish cases on whether $z$ occurs in
  $\beta'$.  

  If $z \# \beta'$, then this \UL is generating a 0-use assumption $z$, so
  we can remove it and the \UL along with $\vec{x}$.  That is, we appeal
  to the inductive hypothesis on the continuation with $\vec{x},z$,
  which gives \seq{\Gamma,z:A-(\vec{x},z)}{\beta'}{C}, i.e.
  \seq{\Gamma,\vec{x}}{\beta'}{C}.  We also have $\beta \spr \beta'$
  because the $[\alpha[\gamma]/z]$ substitution cancels.  So we have
  \seq{\Gamma,\vec{x}}{\beta}{C} by Lemma~\ref{lem:respectspr}.
  
  If $z$ occurs in $\beta'$, we further distinguish cases on whether $x
  \in \vec{x}$ or not.  

  If it is not, then we know $\vec{x} \# \beta$, so pushing this along
  the transformation gives $\vec{x} \# \beta'[\alpha[\gamma]/z]$.  Thus
  $\vec{x} \# \beta'$ (note that $z$ cannot be in $\vec{x}$ because it
  is bound only in the continuation), and because $z$ occurs in
  $\beta'$, $\alpha[\gamma/z]$ occurs in the substitution, so $\vec{x}
  \# \alpha[\gamma]$.  By the relevance assumption, each term in
  $\gamma$ also occurs after the substitution, so $\vec{x} \# \gamma$ as
  well.  Thus, by the inductive hypotheses we get no-bigger derivations
  of \seq{\Gamma-\vec{x}}{\gamma}{\Delta} and
  \seq{\Gamma-\vec{x},z:A}{\beta'}{C}, and the principal $x$ survives in
  $\Gamma-\vec{x}$, so we can reapply \UL.

  Finally, if $x \in \vec{x}$ and $z \in \beta'$, then we have $x \#
  \beta$, so $x \# \beta'[\alpha[\gamma]/z]$ by moving along the
  transformation, and then $x \# \alpha[\gamma]$ by the fact that $z$
  occurs.  However, this contradicts the relevance assumption on
  $\U{x.\alpha}{\Delta}{A}$, which says that $x$ occurs in $\alpha$.  
\end{itemize}

\end{proof}

\begin{lemma} \label{lem:spr-doesnt-introduce}
Suppose each axiom $c : \alpha \spr \beta$ has the property that $x \#
\alpha$ implies $x \# \beta$.  Then for any derivation of $\alpha \spr
\beta$, $x \# \alpha$ implies $x \# \beta$.
\end{lemma}

\begin{proof}
The cases for reflexivity is immediate, and the case for axioms is
assumed.  In the case for transitivity $\alpha \spr \beta_1 \spr
\beta_2$, we get $\vec{x} \# \beta_1$ by the first inductive hypothesis
and then $\vec{x} \# \beta_2$ by the second.  In the case for
congruence, we have $\vec{x} \# \alpha[\beta/y]$.  This means that
either $\vec{x} \# \alpha$ and $\vec{x} \# \beta$, or $\vec{x} \#
\alpha$ and $y \# \alpha$ (in which case $\vec{x}$ might occur in
$\beta$).  In the first case, we get $\vec{x} \# \alpha'$ and $\vec{x}
\# \beta'$ by the inductive hypotheses, so $\vec{x} \#
\alpha'[\beta'/y]$.  In the second, we get $\vec{x},y \# \alpha'$ by the
inductive hypothesis, so $\alpha'[\beta'/y] = \alpha'$, and $\vec{x} \#
\alpha'$.
\end{proof}

\subsection{Affine Logic}

Consider the following rules for affine logic, where the context is
represented by a list of assumptions labeled with variables, and $\Gamma
\splits \Delta_1,\Delta_2$ means interleaving $\Delta_1$ and $\Delta_2$
in some order equals $\Gamma$.

\begin{small}
\[
\begin{array}{c}
\infer{\seqa{\Gamma}{P}}{P \in \Gamma}
\qquad
\infer{\seqa{\Gamma,z:A\otimes B,\Gamma'}{C}}
      {\seqa{\Gamma,\Gamma',x:A,y:B}{C}}
\qquad
\infer{\seqa{\Gamma}{A \otimes B}}
      {\Gamma \splits \Delta_1;\Delta_2 &
        \seqa{\Delta_1}{A} &
        \seqa{\Delta_2}{B}}
\\\\
\infer{\seqa{\Gamma}{A \lolli B}}
      {\seqa{\Gamma,x:A}{B}}
\qquad
\infer{\seqa{\Gamma}{C}}
      {\Gamma \splits \Delta_1;\Delta_2;(f:A \lolli B) &
        \seqa{\Delta_1}{A} &
        \seqa{\Delta_2,z:B}{C}
      }
\end{array}
\]
\end{small}

\noindent Weakening and exchange are admissible for these rules.  

Using the mode theory from Section~\ref{sec:ex:affine}, we translate the
propositions and contexts of adjoint logic as follows:
\[
\begin{array}{rcl}
P^* & = & P \\
(A\otimes B)^* & = & \F{x \otimes y}{x:A^*,y:B^*} \\
(A\lolli B)^* & = & \U{c.c \otimes x}{x:A^*}{B^*} \\
\\
\cdot^* & = & \cdot\\
(\Gamma,x:A)^* & = & \Gamma^*,x:A^*\\
\end{array}
\]
We also define a function that collects the variables from $\Gamma$ as a
context descriptor:
\[
\begin{array}{rcl}
\vars{\cdot} & = & 1\\
\vars{(\Gamma,x:A)} & = & \vars{\Gamma} \otimes x\\
\end{array}
\]

Overall, we have
\begin{theorem}[Adequacy of provability for $\seqa{}{}$] ~\\
$\seqa{\Gamma}{A}$ iff $\seq{\Gamma^*}{\vars{\Gamma}}{A^*}$
\end{theorem}

\begin{proof}

The forward direction is by induction on $\seqa{\Gamma}{A}$:
\begin{itemize}
\item For the hypothesis rule, we need to show
  \seq{\Gamma^*}{\vars{\Gamma}}{P}.  Because $x$ is in $\Gamma$, we can
  prove by induction on $\Gamma$ that $x:P$ is in $\Gamma^*$ and that
  $\vars{\Gamma} \deq \alpha \otimes x$.  Thus, the weakening
  transformation gives $\alpha \otimes x \spr 1 \otimes x \deq
  x$. Therefore we can derive
\[
\infer[\dsd{v}]
      {\seq{\Gamma^*}{\vars{\Gamma}}{P}}
      {x:P \in \Gamma & 
        {\vars{\Gamma}} \spr x}
\]

\item For $\otimes$-left, the inductive hypothesis gives
\seq{\Gamma^*,\Gamma'^*,x:A^*,y:B^*}{\vars{\Gamma} \otimes \vars{\Gamma'} \otimes x \otimes y}{C^*}
and we want 
\seq{\Gamma^*,z:\F{x\otimes y}{x:A^*,y:B^*},\Gamma'^*}{\vars{\Gamma} \otimes z \otimes \vars{\Gamma'}}{C^*}.
This is \FL\/ on the inductive hypothesis, with using associativity and commutativity of
$\otimes$ from the mode theory to move $x \otimes y$ to the end.  

\item 
For $\otimes$-right, we 
have \seq{\Delta_1^*}{\vars{\Delta_1}}{A^*}
and \seq{\Delta_2^*}{\vars{\Delta_2}}{B^*} by the inductive hypotheses,
which we can weaken to
 \seq{\Delta_1^*,\Delta_2^*}{\vars{\Delta_1}}{A^*}
and 
 \seq{\Delta_1^*,\Delta_2^*}{\vars{\Delta_2}}{B^*}, 
and then exchange to 
 \seq{\Gamma^*}{\vars{\Delta_1}}{A^*}
and 
 \seq{\Gamma^*}{\vars{\Delta_2}}{B^*} (using a lemma that when $\Gamma \splits \Delta_1,\Delta_2$,
$\Gamma$ and $(\Delta_1,\Delta_2)$ differ only in order, and that
 reordering is preserved by the mapped application of $*$).  
To apply \FR\/ to derive \seq{\Gamma^*}{\vars{\Gamma}}{\F{x \otimes y}{x:A,y:B}}, it thus suffices to show that 
$\vars{\Gamma} \spr \vars{\Delta_1}\otimes\vars{\Delta_2}$.  In fact
they are $\deq$,  which we can
prove by induction on $\Gamma \splits \Delta_1,\Delta_2$ using the
commutative monoid laws.  

\item For $\lolli$-right, we have
  \seq{\Gamma^*,x:A^*}{\vars{\Gamma}\otimes x}{B^*}
by the inductive hypothesis, which is exactly the premise of using \UR\/
to prove
  \seq{\Gamma^*}{\vars{\Gamma}}{\U{c.c\otimes x}{x:A^*}{B^*}}.  

\item For $\lolli$-left, we have \seq{\Delta_1^*}{\vars{\Delta_1}}{A}
  and \seq{\Delta_2^*,z:B^*}{\vars{\Delta_2}\otimes z}{C^*} by the
  inductive hypothesis, and by similar reasoning to the $\otimes R$
  case, we can weaken and exchange to
  \seq{\Gamma^*,\Gamma'^*}{\vars{\Delta_1}}{A} and
  \seq{\Gamma^*,\Gamma'^*,z:B^*}{\vars{\Delta_2}\otimes z}{C^*} and then
  finally weaken to \seq{\Gamma^*,f:(A\lolli
    B)^*,\Gamma'^*}{\vars{\Delta_1}}{A} and \seq{\Gamma^*,f:(A\lolli
    B)^*,\Gamma'^*,z:B^*}{\vars{\Delta_2}\otimes z}{C^*}.
Thus, we only need to show the transformation premise of
\[
\infer[\UL]{\seq{\Gamma^*,f:(A\lolli B)^*,\Gamma'^*}{\vars{\Gamma}\otimes f \otimes \vars{\Gamma'}}{C^*}}
      {  
        \begin{array}{l}
        {\vars{\Gamma}\otimes f \otimes \vars{\Gamma'}} \spr
        (\vars{\Delta_2} \otimes z)[f \otimes \vars{\Delta_1} /z] \\
        \seq{\Gamma^*,f:(A\lolli B)^*,\Gamma'^*}{\vars{\Delta_1}}{A} \\
        \seq{\Gamma^*,f:(A\lolli B)^*,\Gamma'^*,z:B^*}{\vars{\Delta_2}\otimes z}{C^*}
        \end{array}
      }
\]
In fact 
${\vars{\Gamma}\otimes f \otimes \vars{\Gamma'}} \deq (\vars{\Delta_2} \otimes f \otimes \vars{\Delta_1})$,
which again follows from $\Gamma \splits \Delta_1,\Delta_2$, using associativity and commutativity
of $\otimes$.  
\end{itemize}
In terms of structural property placement, observe that the above proof
uses only identity transformations on \FR\/ and \UL, and uses the
\dsd{w} axiom only at the leaves.  

We need the following facts about the mode theory.  

\begin{lemma} \label{lem:affine-mode-1}
If $\alpha \spr \beta$ then $\alpha \deq \beta \otimes \beta'$
for some $\beta'$.
\end{lemma}
\begin{proof}

In the case for weakening $\alpha \spr 1$ (the only axiom), take
$\beta' = \beta$.  In the case for reflexivity take $\beta' =
1$.  In the case for transitivity, we have $\alpha \spr \beta_1
\spr \beta_2$.  By the second inductive hypothesis, we have
$\beta_1 \deq \beta_2 \otimes \beta_2'$, and by the first we have
$\alpha \deq \beta_1 \otimes \beta_1'$, so 
$\alpha \deq \beta_2 \otimes (\beta_2' \otimes \beta_1')$.  

In the case for congruence, we have
$\alpha_1[\alpha_2/x] \spr \beta_1[\beta_2/x]$
and the inductive hypotheses give
    $\alpha_1 \deq \beta_1 \otimes \beta_1'$
and $\alpha_2 \deq \beta_2 \otimes \beta_2'$.  
Thus, 
$\alpha_1[\alpha_2/x] \deq \beta_1[\beta_2 \otimes \beta_2'/x] \otimes \beta_1'[\beta_2 \otimes \beta_2'/x]$,
and then the right-hand side equals 
$\beta_1[\beta_2/x] \otimes \beta_2^n \otimes \beta_1'[\beta_2 \otimes \beta_2'/x]$
for some $n$.  
This is because, 
for this mode theory, we can rewrite any $\alpha$ as $\alpha' \otimes (x
\otimes \ldots \otimes x)$ where $\alpha'$ does not contain $x$ (because
any context descriptor is equal to a ``polynomial'' giving the
multiplicity of each variable), so in general we have $\alpha[\beta_1
  \otimes \beta_2/x] \deq \alpha' \otimes (\beta_1 \otimes \beta_2)^n
\deq \alpha' \otimes \beta_1^n \otimes \beta_2^n \deq \alpha[\beta_1/x]
\otimes \beta_2^n$.
\end{proof}

\begin{lemma} \label{lem:affine-mode-5}
If $\vars{\Gamma} \deq \alpha_1 \otimes \alpha_2$, 
then $\Gamma \splits \Gamma_1,\Gamma_2$ with 
$\vars{\Gamma_1} \deq \alpha_1$ 
and $\vars{\Gamma_2} \deq \alpha_2$.  
\end{lemma}
\begin{proof}
We define the splitting $\Gamma \splits \Gamma_1,\Gamma_2$ adding each
variable in $\Gamma$ to $\Gamma_1$ if it occurs in $\alpha_1$, or
$\Gamma_2$ if it occurs in $\alpha_2$ and not $\alpha_1$ (occurrence
respects \deq).  Because $\deq$ is associativity, commutativity, and
unit, $\alpha_1$ and $\alpha_2$ have no duplicates and every variable
from \vars{\Gamma} occurs exactly once in one or the other, which gives
$\vars{\Gamma_1} \deq \alpha_1$ and $\vars{\Gamma_2} \deq \alpha_1$.
%% FIXME: last sentence is a little sketchy
\end{proof}

\begin{lemma} \label{lem:affine-mode-4}
If $\vars{\Gamma} \spr \alpha$, then there is a $\Gamma'$ such that
$\Gamma \ge \Gamma'$ and $\alpha \deq \vars{\Gamma'}$.
\end{lemma}

\begin{proof}
By Lemma~\ref{lem:affine-mode-1}, $\vars{\Gamma} \deq \alpha \otimes
\beta$ for some $\beta$.  By Lemma~\ref{lem:affine-mode-5}, this means
$\Gamma \splits \Gamma_1,\Gamma_2$ with $\vars{\Gamma_1} \deq \alpha$.
Then the fact that $\Gamma \splits \Gamma_1,\Gamma_2$ implies $\Gamma
\ge \Gamma_1$ gives the result.
\end{proof}

\begin{lemma} \label{lem:strengthening-affine}
If $\seq{{\Gamma_0}^*}{\alpha}{A^*}$ and $\vec{x} \# \alpha$ then there
is a no larger derivation of $\seq{{\Gamma}^*-\vec{x}}{\alpha}{A^*}$
\end{lemma}

\begin{proof}
We will use Lemma~\ref{lem:0-use-strengthening}.  First, no variables
are free in the range of weakening, so
Lemma~\ref{lem:spr-doesnt-introduce} gives that $\alpha \spr \beta$ and
$x \# \alpha$ imply $x \# \beta$.  Second, we prove by induction that
every subformula of $\Gamma^*$ and $A^*$ is relevant, because the only
context descriptors used are \F{x \otimes y}{x:A,y:B} and \U{c.c \otimes x}{x:A}{B}.
\end{proof}

We now prove that if $\seq{\Gamma^*}{\vars{\Gamma}}{A^*}$ then
$\seqa{\Gamma}{A}$.  The proof is by induction on the size of the
assumption, because we will sometimes use
Lemma~\ref{lem:strengthening-affine} before appealing to the inductive
hypothesis.
\begin{itemize}
\item In the case for the assumption rule, we have
\[
\infer{\seq{\Gamma^*}{\vars{\Gamma}}{P}}
      {x:P \in \Gamma^* &
       \vars{\Gamma} \spr x}
\]
Since $x:P \in \Gamma^*$, $x:P \in \Gamma$, and we can apply the affine
logic rule.  

\item In the case where \UR\/ was used to derive
  \seq{\Gamma^*}{\vars{\Gamma}}{A^*}, $A$ must be $A_1 \lolli A_2$
  (because no other types encode to \Usymb), and the premise is
  \seq{\Gamma^*,x:A_1^*}{\vars{\Gamma}\otimes x}{A_2^*}.  The inductive
  hypothesis gives $\seqa{\Gamma,x:A_1}{A_2}$, and we can apply
  $\lolli$-right.

\item In the case where \FR\/ was used, the conclusion must be $(A_1
  \otimes A_2)$, and we have $\vars{\Gamma} \spr (\alpha_1 \otimes
  \alpha_2)$ with \seq{\Gamma^*}{\alpha_1}{A_1^*} and
  \seq{\Gamma^*}{\alpha_2}{A_1^*}.  By Lemma~\ref{lem:affine-mode-4},
  this means there is a $\Gamma \ge \Gamma'$ with $\vars{\Gamma'} \deq
  (\alpha_1 \otimes \alpha_2)$.  By Lemma~\ref{lem:affine-mode-5}, we
  have $\Gamma' \splits \Gamma_1,\Gamma_2$ with $\vars{\Gamma_1} \deq
  \alpha_1$ and $\vars{\Gamma_2} \deq \alpha_2$. So the premises are
  \seq{\Gamma^*}{\vars{\Gamma_1}}{A_1^*} and
  \seq{\Gamma^*}{\vars{\Gamma_2}}{A_2^*}.  By
  Lemma~\ref{lem:strengthening-affine}, we can modify the premises to
  no-bigger derivations of \seq{\Gamma_1^*}{\vars{\Gamma_1}}{A_1^*} and
  \seq{\Gamma_2^*}{\vars{\Gamma_2}}{A_2^*}.  Thus, by the inductive
  hypotheses we get $\seqa{\Gamma_1}{A_1}$ and $\seqa{\Gamma_2}{A_2}$,
  so $\seqa{\Gamma'}{A_1 \otimes A_2}$.  Then weakening and exchange on
  $\Gamma \ge \Gamma'$ gives the result.

\item 
  In the case where \FL\/ was used, the formula under elimination must
  be the translation of $z:(A_1 \otimes A_2) \in \Gamma$. The premise is
  \seq{\Gamma^*-z,x:A_1^*,y:A_2^*}{\vars{\Gamma}[(x \otimes y)/z]}{C^*},
  and we want \seqa{\Gamma}{C}.  Since \vars{\Gamma} has exactly one
  occurrence of $z$, $\vars{\Gamma}[(x \otimes y)/z] \deq
  (\vars{\Gamma}-z)\otimes x \otimes y$, so by the inductive hypothesis
  we get \seqa{\Gamma-z,x:A_1,y:A_2}{C} by the inductive hypothesis, and
  can apply $\otimes$-left.

\item In the case for \UL, the assumption $f$ that is eliminated must be
  the translation of $f:(A_1 \lolli A_2) \in \Gamma$ , so the premises
  are $\vars{\Gamma} \spr \beta'[f \otimes \alpha/z]$ with
  $\seq{\Gamma^*}{\alpha}{A_1^*}$ and
  $\seq{\Gamma^*,z:A_2^*}{\beta'}{C}$. 

  By Lemma~\ref{lem:affine-mode-4}, there is a $\Gamma'$ with $\Gamma
  \ge \Gamma'$ and $\vars{\Gamma'} \deq \beta'[f \otimes \alpha/z]$.
  Since $\vars{\Gamma'}$ has no duplicates, $z$ occurs at most once in
  $\beta'$ (or else $f$ would occur more than once in the substitution).
  
  If $z$ occurs once in $\beta'$, then because all context descriptors
  are products of variables, we can commute it to the end, writing
  $\beta' \deq \beta'' \otimes z$, so $\vars{\Gamma'} \deq \beta''
  \otimes f \otimes \alpha$.  Since $f$ is in \vars{\Gamma'}, $f$ must
  be declared with some type in $\Gamma'$, and since $\Gamma \ge
  \Gamma'$ and $f:A_1 \lolli A_2 \in \Gamma$, we must have $f:A_1 \lolli
  A_2 \in \Gamma'$.  So by Lemma~\ref{lem:affine-mode-5}, we can split
  $\Gamma' \splits \Delta_1;\Delta_2;f:A_1 \lolli A_2$ where
  $\vars{\Delta_2} \deq \beta''$ and $\vars{\Delta_1} \deq \alpha$.
  Using these equalities, the premises derive
  $\seq{\Gamma^*}{\vars{\Delta_1}}{A_1^*}$ and
  $\seq{\Gamma^*,z:A_2^*}{\vars{\Delta_2} \otimes z}{C}$, so by
  Lemma~\ref{lem:strengthening-affine} we can strengthen to no bigger
  derivations of
  $\seq{\Delta_1^*}{\vars{\Delta_1}}{A_1^*}$ (removing $\Gamma-\Delta_1$) and
  $\seq{\Delta_2*,z:A_2^*}{\vars{\Delta_2} \otimes z}{C}$ (removing $\Gamma-\Delta_2$).
  Then the inductive hypotheses give \seq{\Delta_1}{A_1} and
  \seq{\Delta_2,z:A_2}{C}, so we have the premises to use $\lolli$-left
  to conclude \seq{\Gamma'}{C}.  Finally, we weaken/exchange with
  $\Gamma \ge \Gamma'$.
  Since the splitting implies that $\Gamma' \ge \Gamma_1$ and $\Gamma'
  \ge \Gamma_2$, we have $\Gamma_0,z:A_2 \ge \Gamma_1,z:A_2$ and
  $\Gamma_0 \ge \Gamma_2$.  Moreover, we have $\beta' \deq \vec{y}
  \otimes z \deq \vars{\Gamma_1} \otimes z$ and $\alpha \deq
  \vars{\Gamma_2}$, so the premises are
  $\seq{\Gamma_0^*}{\vars{\Gamma_2}}{A_1^*}$ and
  $\seq{\Gamma_0^*,z:A_2^*}{\vars{\Gamma_1,z:A_2}}{C^*}$.  Thus, the
  inductive hypotheses give \seqa{\Gamma_2}{A_1} and
  \seqa{\Gamma_1,z:A_2}{C}, which combined with the splitting gives
  \seqa{\Gamma'}{C} by $\lolli$-left.  Finally, we have $\Gamma \ge
  \Gamma'$, so we can weaken/exchange to get \seqa{\Gamma}{C}.

  If $z$ occurs 0 times in $\beta'$ (that is, we did a \UL\/ that
  introduced a 0-use variable in the continuation), then we have
  premises \seq{\Gamma^*,z:A_2^*}{\beta'}{C} and $\vars{\Gamma} \spr
  \beta'$ (the substitution cancels).  By Lemma~\ref{lem:affine-mode-4},
  we get $\Gamma \ge \Gamma'$ with $\vars{\Gamma'} \deq \beta'$.  By
  Lemma~\ref{lem:strengthening-affine}, we can remove $z$ and anything
  in $\Gamma$ but not in $\Gamma'$ to get a no-bigger derivation of
  \seq{\Gamma'^*}{\vars{\Gamma'}}{C}.  Then the inductive hypothesis on
  this premise gives \seqa{\Gamma'}{C}, and weakening/exchanging with
  $\Gamma \ge \Gamma'$ gives the result.
\end{itemize}

\end{proof}

\subsection{Cartesian Logic}

We compare the cartesian monoid mode theory from
Section~\ref{sec:ex:relevant-cartesian} with the following rules:
\[
\begin{array}{c}
\infer{\seqc{\Gamma}{P}}{x:P \in \Gamma}
\quad
\infer{\seqc{\Gamma}{A \times B}}
      {\seqc{\Gamma}{A} &
        \seqc{\Gamma}{B}}
\quad
\infer{\seqc{\Gamma}{C}}
      {p:A\times B \in \Gamma & 
        \seqc{\Gamma,x:A,y:B}{C}}
\\\\
\infer{\seqc{\Gamma}{A \to B}}
      {\seqc{\Gamma,x:A}{B}}
\quad
\infer{\seqc{\Gamma}{C}}
      {f: A \to B \in \Gamma &
        \seqc{\Gamma}{A} &
        \seqc{\Gamma,z:B}{C}
      }
\end{array}
\]
In this case, neither round-trip will be the identity on derivations,
though the one starting at these native rules will be the identity up to
a (positive/left) $\eta$ law for $\times$.  The difference is that the
above rules allow contraction for $A \times B$, whereas the framework
reduces this to contraction at $A$ and $B$ separately.  We could instead
compare against a native sequent calculus that does not allow
contraction for positives, but the above is more standard.  

Overall, we have
\begin{theorem}
$\seqc{\Gamma}{A}$ iff \seq{\Gamma^*}{\vars{\Gamma}}{A^*}
\end{theorem}

\begin{proof}
The proof of the forward direction is by induction on the given
derivation, using the derivations of each rule:

\[
\infer[\dsd{v}]{\seq{\Gamma^*}{P^*}}
      {x:P^* \in \Gamma^* &
        1_{(\vars{\Gamma-x})\times x}[\dsd{w}/x] :: \vars{\Gamma-x} \times x \spr x}
\]

\[
\infer[\FR]{\seq{\Gamma^*}{\vars{\Gamma}}{\F{x\times y}{x:A^*,y:B^*}}}
      {\dsd{c} :: \vars{\Gamma} \spr \vars{\Gamma} \times \vars{\Gamma} &
       \seq{\Gamma^*}{\vars{\Gamma}}{A^*} & 
       \seq{\Gamma^*}{\vars{\Gamma}}{B^*}}
\]

\[
\infer[Lemma~\ref{lem:respectspr}]
      {\seq{\Gamma^*}{\vars{\Gamma}}{C^*}}
      { %% 1_{\vars{\Gamma-p}\times p}[\dsd{c}/p] :: 
        \vars{\Gamma} \spr \vars{\Gamma} \times p &
        \infer[Cor.~\ref{cor:contraction}]
              {\seq{\Gamma^*}{\vars{\Gamma}\times p}{C^*}}
              {p : (A\times B)^* \in \Gamma^* &
                \infer[\FL]
                      {\seq{\Gamma^*,q:(A\times B)^*}{\vars{\Gamma}\times q}{C^*}}
                      {\seq{\Gamma^*,x:A^*,y:B^*}{\vars{\Gamma}\times x \times y}{C^*}}}
      }
\]

\[
\infer[\UR]
      {\seq{\Gamma^*}{\vars{\Gamma}}{\U{f.f\times x}{x:A^*}{B^*}}}
      {\seq{\Gamma^*,x:A^*}{\vars{\Gamma}\times x}{B^*}}
\]

\begin{small}
\[
\infer[\UL]
      {\seq{\Gamma^*}{\vars{\Gamma}}{C}}
      {f:(A\to B)^* \in \Gamma^* &
        \vars{\Gamma} \spr \vars{\Gamma} \times (f \times \vars{\Gamma}) &
        \seq{\Gamma^*}{\vars{\Gamma}}{A^*} &
        \seq{\Gamma^*,z:B^*}{\vars{\Gamma}\times z}{B^*}
      }
\]
\end{small}

This shows that the above sequent calculus uses structural rules in the
following places: The hypothesis rule weakens away all other variables.
The $\times$ right rule contracts the entire context.  The $\times$ left
rule uses contraction for the mode theory ($p \spr p \times p$) and
contraction-over-contraction to duplicate $p$ to $q$---if we did not
have a contraction here in the native rule, then this would just be \FL,
as the $\to$ right rule is just \UR.  The $\to$ left rule contracts
everything in $\Gamma$ for use in both the argument and the
continuation, and contracts the function an additional time for use
here.

Conversely, we show \seq{\Gamma^*}{\vars{\Gamma}}{A^*} implies
$\seqc{\Gamma}{A}$ The proof is by induction on the size of the given
derivation, to allow uses of Lemma~\ref{lem:respectspr} before applying
the inductive hypothesis.

\begin{itemize}

\item The hypothesis rule is immediate because $x:P^* \in \Gamma^*$
  implies $x:P \in \Gamma$.  

\item For a general use of \FR, the conclusion must be $(A \times B)^*$
  because this is the only type that encodes to an $\Fsymb$:
\[
\infer{\seq{\Gamma^*}{\vars{\Gamma}}{\F{x\times y}{x:A,y:B}}}
      {\vars{\Gamma} \spr \alpha \times \beta &
        \seq{\Gamma^*}{\alpha}{A} &
        \seq{\Gamma^*}{\beta}{B}}
\]
Because we have projections, we can compose $\vars{\Gamma} \spr \alpha
\times \beta \spr \alpha$ and $\vars{\Gamma} \spr \alpha \times \beta
\spr \beta$, and apply these to the premises by
Lemma~\ref{lem:respectspr} to get no-bigger derivations of
$\seq{\Gamma^*}{\vars{\Gamma}}{A}$ and $\seq{\Gamma^*}{\vars{\Gamma}}{B}$,
and then the inductive hypotheses and $\times$-right give the result.

This corresponds to treating this derivation as if it were 
\[
\infer{\seq{\Gamma^*}{\vars{\Gamma}}{\F{x\times y}{x:A,y:B}}}
      {\vars{\Gamma} \spr \vars{\Gamma} \times \vars{\Gamma} &
        \infer{\seq{\Gamma^*}{\vars{\Gamma}}{A}}
              {\vars{\Gamma} \spr \alpha &
                \seq{\Gamma^*}{\alpha}{A}} &
        \infer{\seq{\Gamma^*}{\vars{\Gamma}}{B}}
              {\vars{\Gamma} \spr \beta &
                \seq{\Gamma^*}{\beta}{B}}
      }
\]
where we contract all variables and weaken the premises with any that
did not already occur in $\alpha/\beta$.  In our equational theory on
derivations these two are indeed equal, assuming equations on
transformations giving the universal property of a cartesian product in
the mode theory.

\item For a general use of \FL, which must be on the encoding of a $p: A
  \times B \in \Gamma$, we have
\[
\infer{\seq{\Gamma^*}{\vars{\Gamma}}{C}}
      {\seq{(\Gamma-p)^*,x:A^*,y:B^*}{\vars{\Gamma}[x \times y/p]}{C}}
\]
Because $\Gamma \deq (\Gamma-p)\times p$, the inductive hypothesis gives
a derivation of \seqc{\Gamma-p,x:A,y:B}{C}.  Using the admissible
weakening for cartesian logic, we have \seqc{\Gamma,x:A,y:B}{C}, so
$\times$-left gives the result.  That is, our given derivation does not
contract $p$, so we weaken with the extra occurence of $p$.

\item For \UR, the inductive hypothesis applied to the premise gives
  exactly the premise of $\to$-right.  

\item For \UL\/ on $f:(A\to B)^*$, we have
\[
\infer{\seq{\Gamma^*}{\vars{\Gamma}}{C^*}}
      {
        {\vars{\Gamma}} \spr \beta'[(f \times \alpha)/z] &
        \seq{\Gamma^*}{\alpha}{A^*} &
        \seq{\Gamma^*,z:B^*}{\beta'}{B^*}
      }
\]
Because all context descriptors are products of variables, we can
rewrite $\beta' \deq \beta'' \times z^k$ for some $k$ and $\beta''$ not
containing $z$.  Thus, we have 
$\vars{\Gamma} \spr \beta'' \times (f \times \alpha)^k$
so using
projections we have
$\vars{\Gamma} \spr \beta''$
and 
$\vars{\Gamma} \spr \alpha$.  
Using contraction, we have 
$\vars{\Gamma} \times z \spr \beta'' \times z^k$.
Applying these to the premises with Lemma~\ref{lem:respectspr}
gives derivations of 
\seq{\Gamma^*}{\vars{\Gamma}}{A^*} 
and 
\seq{\Gamma^*,z:B^*}{\vars{\Gamma}\times z}{B^*}.
Thus, the inductive hypotheses give the premises of $\to$-left.  

Equationally, the only thing suspicious about this is projecting
\emph{one} of the $\alpha$'s from $(f \times \alpha)^k$.   However,
\vars{\Gamma} has no duplicate variables, and for this mode theory any
map $x \spr x^k$ is the $k$-fold contraction of $x$.  Therefore, all
projections are the same, and contracting-projecting-recontracting is
the same as the original contraction.  

\end{itemize}

\end{proof}

\subsection{Constructive S4 \Bx{}{}}

The native rules (writing $\seql{\Delta;\Gamma}{}{A}$ for 
$\validj{\Delta};\truej{\Gamma} \vdash \truej{A}$ assumptions) are
\[
\infer{\seql{\Delta;\Gamma}{}{P}}
      {P \in \Gamma}
\quad
\infer{\seql{\Delta;\Gamma}{}{C}}
      {A \in \Delta & 
       \seql{\Delta;\Gamma,A}{}{C}
      }
\quad
\infer{\seql{\Delta;\Gamma,\Bx{}{A},\Gamma'}{}{C}}
      {\seql{\Delta,A;\Gamma,\Gamma'}{}{C}}
\quad
\infer{\seql{\Delta;\Gamma}{}{\Bx{}{A}}}
      {\seql{\Delta;\cdot}{}{A}}
\]

For the mode theory in Section~\ref{sec:example:box}, we have
\begin{theorem}
\[
\begin{array}{c}
 x_1:\validj{A_1},\ldots,x_n:\validj{A_n};y_1:\truej{B_1},\ldots \vdash \truej{C}\\
\text{iff}\\
\seq{x_1:\Uempty{\dsd{f}}{A_1^*},\ldots,x_n:\Uempty{\dsd{f}}{A_n^*};y_1:B_1^*,\ldots}
    {\dsd{f}(x_1) \times\ldots\times \dsd{f}(x_n) \times y_1 \times \ldots \times y_n}{C^*}
\end{array}
\]
\end{theorem}

\begin{proof}
We write $\Delta^*$ for $\vec{x_i : \Uempty{\dsd{f}}{A_i^*}}$ for each
assumption in $x : A_i \in \Delta$ and $\Gamma^*$ as usual.  
We write \vars{\Delta} for $\dsd{f}(x_1) \times \ldots \dsd{f}(x_n)$ for
the variables in $\Delta$ 
and \vars{\Gamma} as usual.  

First we show that \seql{\Delta;\Gamma}{}{C} implies
\seq{\Delta^*,\Gamma^*}{\vars{\Delta}\times\vars{\Gamma}}{C^*}
by induction, using the following encodings:

\[
\infer{\seq{\Delta^*,\Gamma^*}{\vars{\Delta}\times\vars{\Gamma}}{P}}
      { x:P \in \Gamma^* &
        {\vars{\Delta}\times\vars{\Gamma}} \spr x
      }
\]
where the transformation weakens everything else.  

\[
\infer[\UL]{\seq{\Delta^*,\Gamma^*}{\vars{\Delta}\times\vars{\Gamma}}{C^*}}
      {
        \begin{array}{l}
          x:\Uempty{\dsd{f}}{A^*} \in \Delta^* \\
          {\vars{\Delta}\times\vars{\Gamma}} \spr
          (\vars{\Delta}\times\vars{\Gamma}\times z)[\dsd{f}(x)/z] \\
        \seq{\Delta^*,\Gamma^*,z:A^*}{\vars{\Delta}\times\vars{\Gamma}\times z}{C^*}
        \end{array}
      }
\]
where the transformation contracts the \dsd{f}(x) that must be in $\vars{\Delta}$.

\[
\infer[\FL]{\seq{\Delta^*,\Gamma^*}{\vars{\Delta}\times\vars{\Gamma}}{C^*}}
      {x:\F{\dsd{f}}{\Uempty{\dsd{f}}{A^*}} \in \Gamma^* &
        \infer[\ref{lem:exchange}]
              {\seq{\Delta^*,\Gamma^*-x,z:{\Uempty{\dsd{f}}{A^*}}}
                   {\vars{\Delta}\times\vars{\Gamma-x}\times z}{C^*}}
              {\seq{\Delta^*,z:{\Uempty{\dsd{f}}{A^*}},\Gamma^*-x}{\vars{\Delta}\times\vars{\Gamma-x}\times z}{C^*}}
      }
\]
We took the liberty of making \Bx{}{}-left remove the \Bx{}{}-assumption
(which as usual for positives is a choice), or else we could do a
contraction here to match it.  We use commutativity of $\times$ and
exchange to make the order match the native rule.  

\begin{footnotesize}
\[
\infer[\FR]
      {\seq{\Delta^*,\Gamma^*}{\vars{\Delta}\times\vars{\Gamma}}{\F{\dsd{f}}{\Uempty{\dsd{f}}{A^*}}}}
      { {\vars{\Delta}\times\vars{\Gamma}} \spr 
        \dsd{f}(x_1\times_v \ldots) &
        \infer[\UR]
              {\seq{\Delta^*,\Gamma^*}{(x_1\times_v \ldots)}{{\Uempty{\dsd{f}}{A^*}}}}
              {\infer[\ref{lem:respectspr}]
                {\seq{\Delta^*,\Gamma^*}{\dsd{f}(x_1\times_v \ldots)}{A^*}}
                {{\dsd{f}(x_1\ldots x_n)} \spr {\dsd{f}(x_1) \times \ldots} &
                  \infer[\ref{lem:weakening}]
                        {\seq{\Delta^*,\Gamma^*}{\dsd{f}(x_1) \times \ldots }{A^*}}
                        {\seq{\Delta^*}{\vars{\Delta}}{A^*}}
                }
              }}
\]
\end{footnotesize}
We write $x_1 \ldots$ for the variables from $\Delta$.  The first
transformation weakens away $\Gamma$ and uses the monoidalness
transformation axioms for \dsd{f} to pull \dsd{f} outside the product.
After the \UR, we uses the converse $\dsd{f}(\top_v) \spr \top$ and
$\dsd{f}(x \times_v y) \spr \dsd{f}(x) \times \dsd{f}(y)$ that follow
from the intro forms for the cartesian $(\times,\top)$ and congruence of
\dsd{f}\/ on the projections.  Finally, we weaken-over-weaken the
encoding of the premise with $\Gamma^*$
\end{proof}

\subsection{Non-strong \Dia{}{}}

We compare the mode theory for the non-strong \Dia{}{} (modes \dsd{t}
and \dsd{p} with an affine (semicartesian) commutative monoid
$(\otimes,1,\dsd{w} :: x \spr 1)$ on \dsd{t} and
\oftp{x:\dsd{t}}{\dsd{g}(x)}{\dsd{p}}) against the rules at the
beginning of Section~\ref{sec:example:monad}.

Recall from above that $\Dia{}{A}^* =
\Uempty{\dsd{g}}{\F{\dsd{g}}{A^*}}$ and that the correspondence is:
\begin{theorem}
\[
\begin{array}{c}
\truej{A_1}, \ldots, \truej{A_1} \vdash \truej{C}\\
\text{iff}\\
\seq{x_1:A_1^*,\ldots,x_1:A_n^*}{x_1\otimes\ldots\otimes x_n}{C^*}
\end{array}
\]
and 
\[
\begin{array}{c}
\truej{A_1}, \ldots, \truej{A_b} \vdash \possj{C}\\
\text{iff}\\
\seq{x_1:A_1^*,\ldots,x_1:A_n^*}{\dsd{g}(x_1\otimes\ldots\otimes x_n)}{\F{\dsd{g}}{C^*}}.
\end{array}
\]
\end{theorem}

\begin{proof}
We write $\Gamma^*$ as usual and \vars{\Gamma} for
$x_1\otimes\ldots\otimes x_n$.  

The three rules are represented by
\[
\infer[\FR]
      {\seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}}
      {\dsd{g}(\vars{\Gamma}) \spr \dsd{g}(\vars{\Gamma}) &
        \seq{\Gamma^*}{\vars{\Gamma}}{A^*}}
\]

\[
\infer[\UR]
      {\seq{\Gamma^*}{\vars{\Gamma}}{\Uempty{\dsd{g}}{\F{\dsd{g}}{C^*}}}}
      {\seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}}
\]

\[
\infer{\seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}}
      {x : \Uempty{\dsd{g}}{\F{\dsd{g}}{A^*}} \in \Gamma^* &
        \dsd{g}(\vars{\Gamma}) \spr \dsd{g}(x) &
        \infer[\FL]
              {\seq{y:\F{\dsd{g}}{A}^*}{\dsd{y}}{\F{\dsd{g}}{C^*}}}
              {\seq{z:A^*}{\dsd{g}(z)}{\F{\dsd{g}}{C^*}}}
      }
\]
(and an identity rule $\Gamma,\truej{P} \vdash \truej{P}$ would be
translated as usual)

Conversley, suppose we have a derivation of
\seq{\Gamma^*}{\vars{\Gamma}}{C^*} or
\seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}.
Lemma~\ref{lem:0-use-strengthening} can be used on such derivations: the
equational axioms preserve variables and \dsd{w} removes but does not
add, so we use Lemma~\ref{lem:spr-doesnt-introduce}; and \F{\dsd{g}}{A}
and \Uempty{\dsd{g}}{A} are both relevant, so by induction the encoding
of any sequent is.

Suppose we have \seq{\Gamma^*}{\vars{\Gamma}}{C^*}.  
The hypothesis rule is translated back to itself as usual.  Since there
are no types that encode to \Fsymb, any other final rule must be \UR\/ or \UL,
and the type must be \Uempty{\dsd{g}}{\F{\dsd{g}}{A^*}}.
\begin{itemize}
\item 
If we have
\[
\infer[\UR]
      {\seq{\Gamma^*}{\vars{\Gamma}}{\Uempty{\dsd{g}}{\F{\dsd{g}}{A^*}}}}
      {\seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{A^*}}}
\]
then in the inductive hypothesis gives $\Gamma \vdash \possj{A}$, so we
have $\Gamma \vdash \truej{\Dia{}{A}}$ by rule.  

\item 
Suppose we have 
\[
\infer[\UL]
      {\seq{\Gamma^*}{\vars{\Gamma}}{C^*}}
      {x:{\Uempty{\dsd{g}}{\F{\dsd{g}}{A^*}}} \in \Gamma &
        \vars{\Gamma} \spr \beta'[\dsd{g}(x)/z] &
        \seq{\Gamma^*,z:{\F{\dsd{g}}{A^*}}}{\beta'}{C^*}}
\]
For this mode theory, 
the constants do not allow embedding a \dsd{p}-mode term in a
\dsd{t}-mode term.  Therefore, the subterm $\dsd{g}(x)$ cannot occur in
a ``reduct'' of \vars{\Gamma}, which has mode \dsd{t}.  Thus, $z$ does
not occur in $\beta'$, and $\vars{\Gamma} \spr \beta'$.  Applying
Lemma~\ref{lem:respectspr} to the premise gives a no-bigger derivation
of \seq{\Gamma^*,z:{\F{\dsd{g}}{A^*}}}{\vars{\Gamma}}{C^*}, and applying
Lemma~\ref{lem:0-use-strengthening} to strengthen away $z$ gives a
no-bigger derivation of \seq{\Gamma^*}{\vars{\Gamma}}{C^*}.
Then the inductive hypothesis gives $\Gamma \vdash \truej{C}$ as
desired.  
\end{itemize}

Suppose we have \seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}
and want $\Gamma \vdash \possj{C}$.  Since there are no \Fsymb's in the
context, the only possibilities are \UL\/ and \FR:
\begin{itemize}

\item Suppose we have
\[
\infer[\FR]
      {\seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}}
      {{\dsd{g}(\vars{\Gamma})} \spr \dsd{g}(\alpha) &
        {\seq{\Gamma^*}{\alpha}{C^*}}}
\]
For this mode theory, there are no there are no equalities or
transformations between terms of the form $\dsd{g}(\alpha)$ and any
other \dsd{p}-mode term besides congruence on $\alpha \spr \alpha'$, so
we can extract a transformation $\vars{\Gamma} \spr \alpha$ (such that
the given one is equal to congruence with \dsd{g} on it).  So we get
$\vars{\Gamma} \spr \alpha$ and can use Lemma~\ref{lem:respectspr} to
get a no-bigger derivation of {\seq{\Gamma^*}{\vars{\Gamma}}{C^*}}.  By
the inductive hyptothesis on this premise we get $\Gamma \vdash
\truej{A}$, which gives $\Gamma \vdash \possj{A}$ as desired.  
%% : reflexivity
%% goes to reflexivity, merge composites, and rewrite any congruence 
%% $1_\dsd{g}(\alpha)$ as congruence with $\dsd{g}$

\item Suppose we have 
\[
\infer[\UL]
      {\seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}}
      {\begin{array}{l}
          x:{\Uempty{\dsd{g}}{\F{\dsd{g}}{A^*}}} \in \Gamma \\
          \dsd{g}(\vars{\Gamma}) \spr \beta'[\dsd{g}(x)/z] \\
          \seq{\Gamma^*,z:{\F{\dsd{g}}{A^*}}}{\beta'}{\F{\dsd{g}}{C^*}}
        \end{array}
      }
\]
We have \oftp{x_i:\dsd{t},z:\dsd{p}}{\beta'}{\dsd{p}}, so by inversion
the only possibilities are $z$ or $\dsd{g}(-)$, and in the latter case
$z$ does not occur, as argued above.  

If $\beta'$ is \dsd{z}, then we have 
\seq{\Gamma^*,z:{\F{\dsd{g}}{A^*}}}{z}{\F{\dsd{g}}{C^*}}.  By
Lemma~\ref{lem:0-use-strengthening} (strengthening away $\Gamma^*$) we
have a no-bigger derivation of
\seq{z:{\F{\dsd{g}}{A^*}}}{z}{\F{\dsd{g}}{C^*}}.
By Lemma~\ref{lem:Finv}, we can left-invert to get a no-bigger
derivation of 
\seq{z':{A^*}}{\dsd{g}{(z')}}{\F{\dsd{g}}{C^*}}.  
By the inductive hypothesis, this translates to a derivation of 
$\truej{A} \vdash \possj{C}$, so 
applying \Dia{}{}-left gives the result.

If $z$ does not occur in $\beta'$ we have $\dsd{g}(\vars{\Gamma}) \spr
\beta'$ so pushing this into the premise gives by
Lemma~\ref{lem:respectspr} gives a no-bigger derivation of
\seq{\Gamma^*,z:{\F{\dsd{g}}{A^*}}}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}.
Then strengthening $z$ by Lemma~\ref{lem:0-use-strengthening} gives a
no-bigger derivation of
\seq{\Gamma^*}{\dsd{g}(\vars{\Gamma})}{\F{\dsd{g}}{C^*}}.  so the
inductive hypothesis gives the result.  That is, we did an elimination
to produce a 0-use variable, which we can strengthen away.  
\end{itemize}

\end{proof}

