\newcommand\truej[1]{#1 \,\, \dsd{true}}
\newcommand\possj[1]{#1 \,\, \dsd{poss}}
\newcommand\validj[1]{#1 \,\, \dsd{valid}}
\newcommand\crispj[1]{#1 \,\, \dsd{crisp}}
\newcommand\cohesivej[1]{#1 \,\, \dsd{coh}}

\section{Examples}
\label{sec:exampleencodings}

In this section, we give some examples of logical connectives that can
be represented by mode theories in this framework, and explain
informally why they have the desired behavior with respect to
provability.
%% An additional level to these embeddings is making the
%% equational theory of derivations of \seq{\Gamma}{\alpha}{A} match a
%% desired notion of equality of maps/morphisms, and for this it is often
%% necessary to add some additional equations between structural properties
%% $s \deq s' : \alpha \spr \beta$.

\subsection{Non-associative products}

A mode theory with one mode \dsd{m} and a constant
\[
\begin{array}{c}
\oftp{x : \dsd{m}, y : \dsd{m}}{x \odot y}{\dsd{m}}\\
\end{array}
\]
specifies a completely astructural context (no weakening, exchange,
contraction, associativity), as in non-associative Lambek
calculus~\citep{lambek58calculus}.  

If we write $A \odot B$ for \F{x \odot y}{x:A,y:B} we \emph{cannot}, for
example, derive associativity $A \odot (B \odot C) \vdash (A \odot B)
\odot C$.  To attempt a derivation, we can (without loss of generality)
begin by applying the invertible (Lemma~\ref{lem:Finv}) \FL\/ rule
twice, at which point no further left rules are possible, so we must apply \FR:

\begin{footnotesize}
\[
\infer[\FL]
{\seq{a:\F{x \odot p}{x:A,p:\F{y \odot z}{y:B,z:C}}}
  {a}
  {\F{q \odot z}{q:\F{x \odot y}{x:A,y:B},z:C}}}
{
  \infer[\FL]
        {\seq{x:A,p:\F{y \odot z}{y:B,z:C}}{x \times p}{{\F{q \odot z}{q:\F{x \odot y}{x:A,y:B},z:C}}}}
        {\infer[\FR]
          {\seq{x:A,y:B,z:C}{x \times (y \odot z)}{{\F{q \odot z}{q:\F{x \odot y}{x:A,y:B},z:C}}}}
          {\begin{array}{l}
              {x \odot (y \odot z)} \spr (q \odot z)[\alpha_1/q,\alpha_2/z] \\
              \seq{x:A,y:B,z:C}{\alpha_1}{\F{x \odot y}{x:A,y:B}}\\
              \seq{x:A,y:B,z:C}{\alpha_2}{C}\\
            \end{array}
        }}
}
\]
\end{footnotesize}

\noindent To apply \FR, we need to find a substitution for $\alpha_1/q$
and $\alpha_2/z$ with a structural transformations as above.  In the
absence of any equational or transformation axioms, the only possible
choice is reflexivity, which requires $x/q, (y \odot z)/z$.  Thus we
need to show
\[
\seq{x:A,y:B,z:C}{x}{A \odot B}
\qquad
\seq{x:A,y:B,z:C}{y \odot z}{C}
\]
This is not possible because the context is not divided correctly.  

\subsection{Ordered Products and Implications}

We extend the above mode theory with a constant $1 : \dsd{m}$ and
equations
\[
\begin{array}{c}
x \odot (y \odot z) \deq (x \odot y) \odot z\\
x \odot 1 \deq x \deq 1 \odot x
\end{array}
\]
making $(\odot,1)$ into a monoid.  This makes the context behave like
ordered logic, which has associativity but none of exchange, weakening,
and contraction---a monoidal product that is not symmetric monoidal.

We can complete the above proof of associativity of $\odot$: where we
need to find a substitution such that ${x \odot (y \odot z)} \spr (q
\odot z)[\alpha_1/q,\alpha_2/z]$, we can now choose $(x \odot y)/q,
z/z$ because
\[
{x \odot (y \odot z)} \deq {(x \odot y) \odot z} = (q \odot z)[x \odot y/q, z/z]
\]
Thus, the subgoals are
\[
\seq{x:A,y:B,z:C}{x \odot y}{A \odot B}
\qquad
\seq{x:A,y:B,z:C}{z}{C}
\]
The latter is identity-over-identity (Theorem~\ref{thm:identity}), and
the former is a further \FR\/ and then identities:
\[
\infer{\seq{x:A,y:B,z:C}{x \odot y}{\F{x' \odot y'}{x':A,y':B}}}
      { \begin{array}{l}
          x \otimes y \spr (x' \odot y')[x/x',y/y'] \\
          \seq{x:A,y:B,z:C}{x}{A} \\
          \seq{x:A,y:B,z:C}{y}{B} 
        \end{array}
      }
\]
However, we cannot prove commutativity:

\begin{small}
\[
\infer[\FL]{\seq{p:\F{x\odot y}{x:A,y:B}}{p}{\F{z\odot w}{z:B,w:A}}}
      {\infer[\FR]{\seq{x:A,y:B}{x \odot y}{\F{z\odot w}{z:B,w:A}}}
        {
            x \odot y \spr (z \odot w) [\alpha_1/z,\alpha_2/w] &
            \seq{x:A,y:B}{\alpha_1}{B} &
            \seq{x:A,y:B}{\alpha_2}{A} 
      }}
\]
\end{small}

\noindent because the only choice is $\alpha_1 = x$ and $\alpha_2 = y$, which
sends the wrong resource to each branch.  

Ordered logic has two different implications, one that adds to the left
of the context, and one that adds to the right; the expected rules are

\begin{small}
\[
\begin{array}{l}
\infer{\seql{\Gamma}{o}{ A \rightharpoonup B}}
      {\seql{\Gamma,A}{o}B}
~~
\infer{\seql{\Gamma,A \rightharpoonup B,\Delta,\Gamma'}{o}{C}}
      {\seql{\Delta}{o}{A} &
       \seql{\Gamma,B,\Gamma'}{o}{C}
      }
~~
\infer{\seql{\Gamma}{o}{A \leftharpoonup B}}
      {\seql{A,\Gamma}{o}{B}}
~~
\infer{\seql{\Gamma,\Delta,A \leftharpoonup B,\Gamma'}{o}{C}}
      {\seql{\Delta}{o}{A} &
        \seql{\Gamma,B,\Gamma'}{o}{C}
      }
\end{array}
\]
\end{small}

We represent these by 
\[
\begin{array}{ll}
A \rightharpoonup B := \U{c.c \odot x}{x:A}{B} &
A \leftharpoonup B := \U{c.x \odot c}{x:A}{B}
\end{array}
\]
These have the expected right rules, putting $x$ on the left or right of
the current context descriptor, by the substitution $\beta/c$ in \UR:
\[
\infer{\seq{\Gamma}{\beta}{\U{c.c \odot x}{x:A}{B}}}
      {\seq{\Gamma,x:A}{\beta \odot x}{B}}
\qquad
\infer{\seq{\Gamma}{\beta}{\U{c.x \odot c}{x:A}{B}}}
      {\seq{\Gamma,x:A}{x \odot \beta}{B}}
\]
The instances of \UL\/ are
\[
\begin{array}{l}
\infer{\seq{\Gamma} {\beta} {C}}
      {\begin{array}{l}
          c:\U{c.c \odot x}{x:A}{B} \in \Gamma \\
          \beta \spr \beta'[c \odot \alpha/z] \\
          \seq{\Gamma}{\alpha}{A} \\
          \seq{\Gamma,z:A}{\beta'}{C}
        \end{array}
      }
\qquad
\infer{\seq{\Gamma} {\beta} {C}}
      {\begin{array}{l}
          c:\U{c.x \odot c}{x:A}{B} \in \Gamma \\
          \beta \spr \beta'[\alpha \odot c/z] \\
          \seq{\Gamma}{\alpha}{A} \\
          \seq{\Gamma,z:A}{\beta'}{C}
       \end{array}
      }
\end{array}
\]
Suppose that $\beta$ is of the form $x_1 \odot \ldots c \ldots \odot
x_n$ for distinct variables $x_i$, and consider the rule on the left,
for $\rightharpoonup$.  Because the only structural transformations are
the associativity and unit equations, the transformation must
reassociate $\beta$ as $\beta_1 \odot (c \odot \alpha) \odot \beta_2$,
with $\beta' = \beta_1 \odot z \odot \beta_2$, for some $\beta_1$ and
$\beta_2$.  Here $\alpha$ plays the role of $\Delta$ in the ordered
logic rule---the resources used to prove $A$, which occur to the right
of the implication being eliminated.  Reading the substitution
backwards, the resources $\beta'$ used for the continuation are
``$\beta$ with $c \odot \alpha$ replaced by the result of the
implication,'' as desired.  While $c$ and any variables used in $\alpha$
are still in $\Gamma$, permission to use them has been removed from
$\beta'$---and there is no way to restore such permissions in this mode
theory.  The rule for $\leftharpoonup$ is the same, but with $\alpha$ on
the opposite side of $c$.

More formally, for an ordered logic formula built from $\odot
\leftharpoonup \rightharpoonup$ and atoms, write $A^*$ for the
translation to the above encodings, and extend this pointwise to
$\Gamma^*$ for an ordered logic context $\Gamma$.  Further, define
$\vars{x_1:A_1,\ldots,x_n:A_n} = x_1 \odot \ldots \odot x_n$.  Then the
encoding of ordered logic is adequate in the sense that
$\seql{\Gamma}{o}{A}$ iff $\seq{\Gamma^*}{\vars{\Gamma}}{A^*}$.  The
proof is very similar to the proof for affine logic discussed in
Example~\ref{sec:ex:affine}.  The analogous translation of types and
judgements and adequacy statement is used for
Examples~\ref{sec:ex:linear},\ref{sec:ex:affine},\ref{sec:ex:relevant-cartesian}.

\subsection{Linear products and implication}
\label{sec:ex:linear}

Linear logic is ordered logic with exchange, so to model this we add a
commutativity equation
\[
x \otimes y \deq y \otimes x
\]
(and switch notation from $\odot$ to $\otimes$).  For example, we can
derive {\seq{p : A \otimes B}{p}{B \otimes A}}:
\[
\infer[\FL]
      {\seq{p:\F{x\otimes y}{x:A,y:B}}{p}{\F{z\otimes w}{z:B,w:A}}}
      {\infer[\FR]{\seq{x:A,y:B}{x \otimes y}{\F{z\otimes w}{z:B,w:A}}}
        {
            x \otimes y \spr (z \otimes w) [y/z,x/w] &
            \seq{x:A,y:B}{y}{B} &
            \seq{x:A,y:B}{x}{A} 
      }}
\]
where the first premise is exactly $x \otimes y = y \otimes x$.

For this mode theory, \U{c.c \odot x}{x:A}{B} and \U{c.x \odot
  c}{x:A}{B} are equal types (because commutativity is an equation, and
types are parametrized by equivalence-classes of context descriptors),
and both represent $A \lolli B$.  

%% The linear logic $\multimap$-left rule (where contexts are implicitly
%% treated modulo exchange) is
%% \[
%% \infer{\Gamma,\Delta,A \multimap B \vdash C}
%%       {\Delta \vdash A &
%%        \Gamma,B \vdash C}
%% \]
%% We have
%% \[
%% \infer{\seq{\Gamma} {\beta} {C}}
%%       {c:\U{c.c \otimes x}{x:A}{B} \in \Gamma &
%%        \beta \deq \beta'[c \odot \alpha/z] &
%%        \seq{\Gamma}{\alpha}{A} &
%%        \seq{\Gamma,z:A}{\beta'}{C}
%%       }
%% \]

\subsection{Multi-use variables}
\label{sec:ex:nlinear}

An $n$-use variable (see \citep{reed08namessubstructural} for example)
is like a linear variable, but instead of being used ``exactly once''
(modulo additives), it is used ``exactly $n$ times.''  In the above
work, $0$-use variables were used in an encoding of nominal techniques;
another application of $n$-use variables is static analysis of
functional programs
%% \footnote{Andreas Abel described a similar system
%%   that is used in Agda}
(e.g. counting how many times a variable occurs to decide whether it
will be efficient to unfold a substitution).

%% n-use functions [Wright, Momigliano]
%% • Other 0-use (“irrelevant”) functions [Pfenning, Ley-Wild]
%% • RLF [Ishtiaq, Pym]
%% • HLF
%% – Designed for statement of metatheorems for Linear LF.
%% – Does n-linear Πs above, and more (e.g. some of BI)
%% – Prototype implementation

We use the following sequent calculus rules for $n$-linear functions 
\begin{small}
\[
\infer{{0\cdot \Gamma,x:^1 P} \vdash {P}}
      {}
\qquad
\infer{\Gamma \vdash A \to^n B}
      {{\Gamma, x :^n A} \vdash {B}}
\qquad
\infer{\Gamma + f:^k A \to^n B + (nk \cdot \Delta) \vdash C}
      {\Delta \vdash A &
       {\Gamma, z :^k B} \vdash {C}}
\]
\end{small}%
\noindent where $\Gamma + \Delta$ acts pointwise by $x :^{n} A + x :^{m}
A = x :^{n+m} A$ and $n \cdot \Delta$ acts pointwise by $n \cdot x^{m} A
= x :^{nm} A$.  In the left rule, $\Gamma$ and $\Delta$ have the same
underlying variables and types (but potentially different counts), and
$f:^kA \to^n B$ abbreviates a context with the same variables and types
but $0$'s for all counts besides $f$'s.  The left rule says that if you
spend $k$ ``uses'' of a function that takes $n$ uses of an
argument, then you need $nk$ uses of whatever you use to
construct the argument, in order to get $k$ uses of the result.  

We can model this in the linear mode theory by using context descriptors
that are themselves non-linear:
\[
\begin{array}{rcl}
x^0 & := & 1 \\
x^{n+1} & := & x^n \otimes x \\
A \to^n B & := & \U{c.c \otimes (x^n)}{x:A}{B} \\
\end{array}
\]

This has the following instances of \UL{}{} and \UR{}: 
\[
\infer{\seq{\Gamma}{\beta}{A \to^n B}}
      {\seq{\Gamma, x:A}{\beta \otimes x^n}{B}}
\qquad
\infer{\seq{\Gamma}{\beta}{C}}
      {\begin{array}{l}
          f : \U{f.f \otimes x^n}{x : A}{B} \in \Gamma \\
          \beta \spr \beta'[f \otimes (\alpha)^n/z] \\
          \seq{\Gamma}{\alpha}{A} \\
          \seq{\Gamma, z:B}{\beta'}{C} 
       \end{array}
      }
\]
For this mode theory, the only transformations are the commutative
monoid equations, and we can commute $\beta'$ to the form $\beta''
\otimes z^k$ for some $k$ and $\beta''$ not mentioning $z$ because any
context descriptor is a polynomial of variables. Thus the premise is
really of form $\beta \deq (\beta'' \otimes z^k) [f \otimes
  (\alpha)^n/z]$, which is equal to $\beta'' \otimes f^k \otimes
(\alpha)^{nk}$.  Here $\beta''$ corresponds to the $\Gamma$ in the above
left rule (the resources used in the continuation, besides $z^k$) and
$\alpha$ corresponds to $\Delta$.  Overall, we have $x_1:^{k_1}
A_1,\ldots,x_n :^{k_n} A_n \vdash C$ iff
\seq{x_1:A_1^*,\ldots,x_n:A_n^*}{x_1^{k_1} \otimes \ldots \otimes
  x_n^{k_n}}{C^*} (where $A^*$ translates atoms to themselves and each
$A \to^n B$ as indicated above).

We can also consider an $n$-use product 
$A^n := \F{x^n}{x:A}$
as a positive type, which will decompose $A \to^n B$ as $A^n \lolli B$
(by Lemma~\ref{lem:fusion}).  This has a map \seq{p:A^n}{p}{A \otimes
  \ldots \otimes A} but not a converse map \seq{p:A \otimes \ldots \otimes
  A}{p}{A^n}.  For example, we have
\[
\infer {\seq{p:\F{x \otimes x}{x:A}}{p}{\F{x \otimes y}{x:A,y:A}}}
       {\infer {\seq {x:A}{x \otimes x}{\F{x \otimes y}{x:A,y:A}}}
               {x \otimes x \deq (y \otimes z)[x/y,x/z] &
                \seq{x:A}{x}{A} &
                \seq{x:A}{x}{A}}
       }
\]
the essence of which is the contraction in the substitution
$[x/y,x/z]$.  However,
\[
\infer {\seq{p:\F{y \otimes z}{y:A,z:A}}{p}{\F{x \otimes x}{x:A}}}
       {\infer {\seq {y:A,z:A}{y \otimes z}{\F{x \otimes x}{x:A}}}
               {y \otimes z \deq (x \otimes x)[?/x] &
                \ldots
               }
       }
\]
is not derivable, because there is no substitution into $x \otimes x$
that makes it equal to $y \otimes z$ for distinct $y$ and $z$.
Conceptually, we think of $A^2$ as expressing a notion of identity: it
is a \emph{single} $A$ that can be used twice, which is stronger than
having two potentially different $A$'s.
%% This might be useful for
%% applications of linear logic to imperative or concurrent programming,
%% where there is a notion of identity of memory cells or resources.  

\subsection{Affine products and implications}
\label{sec:ex:affine}

If we extend the linear logic mode theory with our first directed
structural transformation $\dsd{w} :: x \spr 1$ then we get weakening.
For example, we can define a projection
\[
\infer[\FL]{\seq{p : A \otimes B}{p}{A}}
           {\infer[Lemma~\ref{lem:respectspr}]
             {\seq{x:A,y:B}{x \otimes y}{A}}
             {\infer{x \otimes y \spr x}
                    {y \spr 1}
               &
               \infer[Theorem~\ref{thm:identity}]{\seq{x:A,y:B}{x}{A}}{}
             }}
\]

We give the full adequacy proof for this example in the appendix.
Inspecting this proof, we can see that the translation from a ``native''
sequent proof in affine logic to our framework and back is the identity
on cut-free derivations.  The other round-trip is not the identity,
because the framework allows two things that the native sequent calculus
does not.  First, the framework allows weakening at the non-invertible
rules, rather than pushing it to the leaves.  For example, we have
the following two derivations of $P,Q,R \vdash P \otimes R$.

\begin{footnotesize}
\[
\infer[\FR]
      {\seq{x:P,y:Q,z:R}{x \otimes y \otimes z}{\F{x' \otimes z'}{x':P,z':R}}}
      {x \otimes y \otimes z \spr ((x \otimes y) \otimes z) &
        \infer[\dsd{v}]
              {\seq{x:A,y:B,z:C}{x \otimes y}{C}}
              {(x \otimes y) \spr x} &
        \infer[\dsd{v}]
              {\seq{x:A,y:B,z:C}{z}{C}}
              {z \spr z}
      }
\]
\end{footnotesize}
\begin{footnotesize}
\[
\infer[\FR]
      {\seq{x:P,y:Q,z:R}{x \otimes y \otimes z}{\F{x' \otimes z'}{x':P,z':R}}}
      {x \otimes y \otimes z \spr (x \otimes z) &
        \infer[\dsd{v}]
              {\seq{x:A,y:B,z:C}{x}{C}}
              {x \spr x} &
        \infer[\dsd{v}]
              {\seq{x:A,y:B,z:C}{z}{C}}
              {z \spr z}
      }
\]
\end{footnotesize}%

\noindent The second is that a derivation may perform a left rule on a
$0$-linear (in the sense of the previous section) variable, i.e. one
that does not occur in the context descriptor.  Such variables arise
because \UL\/ ``removes a variable from the context'' by marking it as
0-use, not by actually removing it.  For this mode theory (and the other
ones we consider, besides the previous section), these left rules
produce only other 0-use variables, which ultimately cannot be used, and
can be strengthened away (see Lemma~\ref{lem:0-use-strengthening}).

\subsection{Relevant and Cartesian products and implications}
\label{sec:ex:relevant-cartesian}

Next, we consider a logic with contraction, e.g. a map
$A \vdash (A \otimes A)$.  We always have the left and right components
of the chain
\[
\begin{array}{llllllll}
A & \cong & \F{x}{x:A}  & \vdash^? & \F{x \otimes x}{x:A} & \vdash & \F{x \otimes y}{x:A, y : A}
\end{array}
\]
The left isomorphism is just \FL/\FR, while the right map was given in
Example~\ref{sec:ex:nlinear}.  To give the middle map $\F{x}{x:A} \vdash
\F{x \otimes x}{x:A}$, it suffices to add a structural transformation
$\dsd{c} :: x \spr x \otimes x$.  because \dsd{F} is covariant on
structural transformations (Lemma~\ref{lem:typespr}).  Then we have $A
\vdash A^2 \vdash (A \otimes A)$ but neither of the converses.

Moreover, if we have both $\dsd{w} :: x \spr 1$ and $\dsd{c} :: x \spr x
\otimes x$, then $x \otimes y$ will behave like a cartesian product in
the mode theory (with projections $x \otimes y \spr x$ and $x \otimes y
\spr y$ and pairing of $z \spr x$ and $z \spr y$ to $z \spr x \otimes
y$), and consequently $A \otimes B$ will behave like a cartesian product
type, and $\U{c.c \otimes x}{x:A}{B}$ like the usual structural $A \to B$.
We refer to this mode theory as an
\emph{cartesian monoid} and write $(\times,\top)$ for it.

%% In this setting, we have both $A \vdash \F{x \otimes x}{x:A}$ (by
%% contraction) and $\F{x \otimes x}{x:A} \vdash A$ (by projection).  It
%% seems reasonable to make this an isomorphism, rather than just an
%% interprovability, expressing the idea that in a cartesian setting, a
%% one-use $A$ is exactly the same as a two-use $A$.  (On the other hand,
%% we do not want $A \cong (A \times A)$, because a single $A$ is not the
%% same as two potentially different $A$'s).  To accomplish this, we can
%% take contraction to be an equation $x \deq x \otimes x$ (idempotence of
%% $\otimes$) rather than a directed transformation.  This makes $A \cong
%% A^2 \dashv\vdash A \times A$.  We refer to the mode of theory for an
%% idempotent commutative monoid with a weakening transformation as an
%% \emph{idempotent cartesian monoid} and write $(\times,\top)$ for it.

\subsection{Bunched Implication (BI)} Bunched implication~\citep{ohearnpym99bunched}
has two context-forming operations $\Gamma,\Gamma'$ and
$\Gamma;\Gamma'$, along with corresponding products and implications.
Both are associative, unital, and commutative, but $;$ has weakening
and contraction while $,$ does not.  A context is represented by a tree
such as $(x:A, y:B);(z : C, w : D)$ (considered modulo the laws), and
the notation $\Gamma[\Delta]$ is used to refer to a tree with a hole
$\Gamma[-]$ that has $\Delta$ as a subtree at the hole.  In sequent
calculus style, the rules for the product and implication corresponding
to $,$ are
\[
\begin{array}{l}
\infer{\Gamma[A * B] \vdash C}
      {\Gamma[A , B] \vdash C}
\quad
\infer{\Gamma,\Delta \vdash A * B}
      {\Gamma \vdash A &
       \Delta \vdash B}
\quad
\infer{\Gamma \vdash A \magicwand B}
      {\Gamma, A \vdash B}
\quad
\infer{\Gamma[A \magicwand B, \Delta] \vdash C}
      {\Delta \vdash A &
       \Gamma[B] \vdash C}
\end{array}
\]
There are similar rules for a product and implication for $;$ as well as
structural rules of weakening and contraction for it.

We can model BI by a mode \dsd{m} with a commutative monoid $(*,I)$ and
a cartesian monoid $(\times,\top)$.  
%% \[
%% \begin{array}{l}
%% x  : \dsd{m}, y  : \dsd{m} \vdash x \times y : \dsd{m} \\
%% \cdot \vdash \top : \dsd{m} \\
%% x  : \dsd{m}, y  : \dsd{m} \vdash x * y : \dsd{m} \\
%% \cdot \vdash \dsd{I} : \dsd{m} \\
%% \end{array}
%% \]
%% where both $(\times,\top)$ and $(*,I)$ are commutative monoids, $\times$
%% is idempotent, and $\top$ (but not $I$) is terminal ($x \spr \top$).  
We define the BI products and implications using the monoids:
\[
\begin{array}{ll}
A * B := \F{x * y}{x : A, y : B}  &
A \magicwand B := \U{c.c * x}{x : A}{B} \\
A \times B := \F{x \times y}{x : A, y : B} &
A \to B := \U{c.c \times x}{x : A}{B}\\
\end{array}
\]
A context descriptor such as $(x \times y) * (z \times w)$ captures
the ``bunched'' structure of a BI context, and substitution for a
variable models the hole-filling operation $\Gamma[\Delta]$.  The left
rule for $*$ (and similarly $\times$) acts on a leaf
\[
\infer{\seq{\Gamma,z:A*B,\Gamma'}{\beta}{C}}
      {\seq{\Gamma,\Gamma',x:A,y:B}{\subst{\beta}{x * y}{z}}{C}}
\]
and replaces the leaf where $z$ occurs in the tree $\beta$ with the
correct bunch $x*y$, The left rule for $\magicwand$ (and similarly for
$\to$)
\[
\infer{\seq{\Gamma}{\beta}{C}}
      {
        c : A \magicwand B \in \Gamma &
        \beta \spr \beta'[ c * \alpha / z] & 
        \seq{\Gamma}{\alpha}{A} &
        \seq{\Gamma,z:B}{\beta'}{C} 
      }
\]
isolates a subtree containing the implication $c$ and resources $*$'ed
with it, uses those resources to prove $A$, and then replaces the
subtree with the variable $z$ standing for the result of the
implication.

We assume the BI sequent is given as a judgement $\Gamma \vdash A$ where
$\Gamma$ is a tree and there are explicit equality premises for the
algebraic laws on bunches.  Then we define $\Gamma^*$ as an in-order
flattening of the tree into one of our contexts (e.g.  $(x:A)^* = x:A^*$ and
$(\Gamma,\Delta)^* = (\Gamma;\Delta)^*=\Gamma^*,\Delta^*$), while we
define $\vars{\Gamma}$ as a context descriptor that preserves the tree
structure (e.g. $\vars{x:A} = x$ and $\vars{(\Gamma,\Delta)} =
\vars{\Gamma}*\vars{\Delta}$ and
$\vars{\Gamma;\Delta}=\vars{\Gamma}\times\vars{\Delta}$).  Then we have
the usual adequacy statement $\Gamma \vdash A$ iff
\seq{\Gamma^*}{\vars{\Gamma}}{A^*}.

\subsection{Adjoint decomposition of !}  
\label{sec:example:bang}

Following \citet{benton94mixed,bentonwadler96adjoint}, we decompose the
$!$ exponential of intuitionistic linear logic as the comonad of an
adjunction between ``linear'' and ``cartesian'' categories.  We start
with two modes \dsd{l} (linear) and \dsd{c} (cartesian), along with a
commutative monoid $(\otimes,1)$ on \dsd{l} and a cartesian
monoid $(\times,\top)$ on \dsd{c}.  Next, we add a context descriptor
from \dsd{c} to \dsd{l} ($x : \dsd{c} \vdash \dsd{f}(x) : \dsd{l}$)
that we think of as including a cartesian context in a linear context.
This generates types 
\[
\wftype {\F{\dsd{f}(x)}{x : A_{\dsd{c}}}}{\dsd{l}}
\qquad
\wftype {\U{x.\dsd{f}(x)}{\cdot}{A_{\dsd{l}}}}{\dsd{c}}
\]
which are adjoint $\F{\dsd{f}(x)}{x:-} \la
{\U{x.\dsd{f}(x)}{\cdot}{-}}$.  The bijection on hom-sets is defined
using \FL\/ and \FR\/ and their invertibility
(Corollary~\ref{cor:Uinv}, Lemma~\ref{lem:Finv}):
\[
\infer={\seq{p:\F{\dsd{f}(x)}{x:A}}{p}{B}}
       {\infer={\seq{x:A}{\dsd{f}(x)}{B}}
               {\seq{x:A}{x}{\U{x.\dsd{f}(x)}{\cdot}{B}}}}
\]
The comonad of the adjunction
\F{\dsd{f}(x)}{x:\U{c.\dsd{f}(c)}{\cdot}{A}} is the linear logic $!A$.

In the LNL models and sequent calculus~\citep{benton94mixed}, $F(A
\times B) \cong F(A) \otimes F(B)$ and $F(\top) \cong 1$, which we can
add to the mode theory by equations 
\[
\dsd{f}(x \times y) \deq \dsd{f}(x) \otimes \dsd{f}(y)
\qquad \dsd{f}(\top) \deq 1
\]
These equations then extend to isomorphisms using Lemma~\ref{lem:fusion}
because all of $F,\otimes,\times$ are represented by \Fsymb-types in our
framework.  These properties of \dsd{f} are necessary to prove that $!
A$ has weakening and contraction (with respect to $\otimes$) and $!A
\otimes !B \vdash !(A \otimes B)$, for example.  Omitting these
equations allows us to describe non-monoidal (or lax monoidal, if we add
only one direction) left adjoints.

In general, we translate $F(A)^* = \F{\dsd{f}(x)}{x:C^*}$ and $G(A)^* =
\U{x.\dsd{f}(x)}{\cdot}{A}$ and products and functions as usual.
Then a sequent $x_1:C_1,\ldots,x_n:C_n \vdash C$ in the cartesian
category is represented by a sequent
\seq{x_1:C_1^*,\ldots,x_n:C_n^*}{x_1 \times \ldots \times x_n}{C^*}, 
and 
a mixed sequent with cartesian and linear assumptions and a linear
conclusion  $x_1:C_1,\ldots,x_n:C_n;y_1:A_1,\ldots,y_m:A_m \vdash A$ 
by 
\seq{x_1:C_1^*,\ldots,y_1:A_1^*,\ldots}{\dsd{f}(x_1) \otimes\ldots\otimes
  \dsd{f}(x_n)  \otimes y_1 \otimes \ldots \otimes y_n}{A^*}.


%% The $ \dsd{f}(x) \otimes \dsd{f}(y) \spr \dsd{f}(x \times y)$
%% direction is used to prove the purely linear logic entailment $!A
%% \otimes !B \vdash !(A \otimes B)$, for example.

%% For example, for contraction we can begin
%% \[
%% \infer{\seq{p : ! A}{p}{! A \otimes ! A}}
%%       {\infer{\seq{{x:\U{c.\dsd{f}(c)}{\cdot}{A}}}{f(x)}{{! A \otimes ! A}}}
%%              {\begin{array}{l}
%%                  f(x) \spr (x' \otimes y') [\dsd{f}(x) / x' , \dsd{f}(x) / y'] \\
%%                  \seq{x:\U{c.\dsd{f}(c)}{\cdot}{A}}{\dsd{f}(x)}{! A} \\
%%                  \seq{x:\U{c.\dsd{f}(c)}{\cdot}{A}}{\dsd{f}(x)}{! A} 
%%                \end{array}
%%              }}
%% \]
%% and we can derive \seq{x:\U{c.\dsd{f}(c)}{\cdot}{A}}{\dsd{f}(x)}{! A}
%% by \FR\/ (it is of the ``axiomatic'' form
%% $\seq{x:C}{f(x)}{\F{\dsd{f}(x)}{x:C}}$).  The key point is that the first
%% premise, which reduces to
%% \[
%% \dsd{f}(x) \spr \dsd{f}(x) \otimes \dsd{f}(x)
%% \]
%% can be deduced as
%% \[
%% \dsd{f}(x) \deq \dsd{f}(x \times x) \deq \dsd{f}(x) \otimes \dsd{f}(x)
%% \]
%% by contraction for $\times$ \emph{if we add an axiom that \dsd{f}
%%   (strictly) preserves the monoidal product}
%% \[
%% \dsd{f}(x \times y) \deq \dsd{f}(x) \otimes \dsd{f}(y)
%% \]

%% Similarly, to get weakening we take $\dsd{f}(\top) \deq 1$.  

\subsection{Adjoint decomposition of $\Box$}  
\label{sec:example:box}

The modal S4 \Bx{}{} as in \citet{pfenningdavies} is similar to !.  We
call the two modes \dsd{t}ruth and \dsd{v}alidity and have 
cartesian monoids on both (we write $(\times,\top)$ for the \dsd{t} one
and $(\times_v,\top_v)$ for the \dsd{v} one) along with $x : \dsd{v}
\vdash \dsd{f}(x) : \dsd{t}$.  Here, following the analysis of \Bx{}{}
as a monoidal comonad~\citep{alechina+01categoricals4}, we have only lax
monoid-preservation axioms
\[
\dsd{f}(x) \times \dsd{f}(y) \spr \dsd{f}(x \times_v y) \\
\qquad
\top \spr \dsd{f}(\top_v)
\]
though the difference is only at the level of equality of
derivations.\footnote{Because the context monoids are cartesian
  products, there are always converse maps, e.g.  $\dsd{f}(x \times_v y)
  \spr \dsd{f}(x) \times \dsd{f}(y)$ defined by pairing, projection, and
  congruence.  However, in the equational theory of proofs in
  S4~\citep{pfenningdavies}, there is a section-retraction $(\Box A
  \times \Box B) \rightarrowtail \Box (A \times B) \twoheadrightarrow
  (\Box A \times \Box B)$ but not an isomorphism. If we had equalities
  above, they would generate type isomorphisms $\dsd{F}(A \times_v B)
  \cong \dsd{F}(A) \times \dsd{F}(B)$, and because the right-adjoint
  $\dsd{U}$ preserves products, we would have $\dsd{F} \dsd{U} (A \times
  B) \cong \dsd{F}(U A \times_v U B) \cong (\dsd{FU}(A) \times
  \dsd{FU}(B))$, which does not match the existing theory---though it is
  a reasonable alternative to consider.
%% I think it reduces to p : Box A =?= letbox x = p in letbox y = p in box(fst x, snd y)
}
We represent a sequent 
\[
 x_1:\validj{A_1},\ldots,x_n:\validj{A_n};y_1:\truej{B_1},\ldots \vdash \truej{C}
\]
by 
\[
\seq{x_1:\Uempty{\dsd{f}}{A_1^*},\ldots,x_n:\Uempty{\dsd{f}}{A_n^*};y_1:B_1^*,\ldots}
    {\dsd{f}(x_1) \times\ldots\times \dsd{f}(x_n) \times y_1 \times \ldots \times y_n}{C^*}
\]


\subsection{Subexponentials}

Subexponentials~\citep{danos+93subexponentials,nigammiller09subexponentials} extend linear logic with a family of
comonads $!_a A$.  All of the comonads are monoidal ($!_a A \otimes !_a
B \vdash !_a(A \otimes B)$ and $1 \vdash !_a A$), and there is a
preorder $a \le b$ such that $!_b A \vdash !_a A$.  Each $!_a$ is
allowed to have weakening and/or contraction, subject to the constraint
that when $a \le b$, $b$ must be at least as structural as $a$.

We illustrate the embedding on a specific example of the diamond
preorder generated by $\dsd i < \dsd j,\dsd k < \dsd m$.  Following
\citep[Example 4.3]{reed09adjoint}, we identify each subexponential $a$
with a mode, and have an additional mode \dsd{l} for basic linear truth,
all with commutative monoids $(\otimes_a,1_a)$.  We add context
descriptor constants \oftp{x : b}{ba(x)}{a} for each $a < b$ (so, in
this example, \dsd{mk}, \dsd{mj}, \dsd{ji}, \dsd{ki}), with an
additional \oftp{x:\dsd i}{\dsd{il}(x)}{\dsd l}.  These include each
``higher'' mode into the immediately ``lower'' ones, and the lowest ones
into \dsd{l}.  We add an equation $\dsd{ji}(\dsd{mj}(x)) \deq
\dsd{ki}(\dsd{mk}(x))$ that the diamond commutes.  Then $!_b A$ is the
comonad $\F{b{\dsd l}(x)} {x : \U{x.b\dsd{l}(x)}{\cdot}{A}}$ for the
unique $\oftp{x : b}{b{\dsd l}}{\dsd{l}}$ generated by these constants.
For example, $!_k$ is the comonad of $\oftp{x :
  \dsd{k}}{\dsd{il}(\dsd{ki}(x))}{\dsd{l}}$.

This mode theory is constructed so that every mode has a unique map to
\dsd{l}.  When $a \le b$, we have a morphism \oftp{x:b}{ab(x)}{a}, so
the morphism \oftp{x:b}{b\dsd{l}(x)}{\dsd{l}} is equal to
\oftp{x:b}{a\dsd{l}(ba(x))}{\dsd{l}}.  Thus, by Lemma~\ref{lem:fusion},
we have
\[
!_b A = \dsd{F}_{{b\dsd{l}}}(\dsd{U}_{{b\dsd{l}}} A) \cong \dsd{F}_{{a\dsd{l}}}\dsd{F}_{{ba}} \dsd{U}_{{ba}} \dsd{U}_{{a\dsd{l}}} A
\]
The map $!_b A \vdash !_a A$ can thus be defined as the counit
$\dsd{F}_{{ba}} \dsd{U}_{{ba}} A \vdash A$ for the comonad in the middle.

We add equations $ba(x \otimes_b y) \deq ba(x) \otimes_a ba(y)$ and
$ba(1_b) \deq 1_a$ making each generator strictly monoidal.  This
ensures that each $!_b$ is monoidal and that $!_b A$ can be weakened or
contracted if $(\otimes_b,1_b)$ has weakening or contraction (and more
generally that \F{ba}{B} can be weakened or contracted for any $B$, not
just $\dsd{U}_{ba}{(A)}$).  Thus, we add weakening or contraction to
a particular subexponential $a$ by adding them to $(\otimes_a,1_a)$.
%% assuming only monoid axioms (not that one is cartesian), 
%% - !_b A \otimes !_b B \vdash !_b(A \otimes B) uses both directions of ba(x \otimes_b y) <=> ba(x) \otimes_a ba(y)
%% - 1 \vdash !_b(1) uses both directions of ba(1_b) \deq 1_a
%% - contraction uses f(a . b) => f(a) . f(b) direction
%% - weakening uses f(1) => 1 direction

Interestingly, when $a \le b$, it does not seem that we need a condition
that $(\otimes_b,1_b)$ has whatever structural properties
$(\otimes_a,1_a)$ has in order to get that $!_b A$ is at least as
structural as $!_a A$.  As argued above $!_b A$ factors into the form
$\dsd{F}_{a{\dsd l}}(C)$, which has whatever structural properties mode $a$ has.

%% Following \citep[Example 4.3]{reed09adjoint}, we identify each
%% subexponential $i$ with a mode.  We put a commutative monoid
%% $(\otimes_i,1_i)$ on each mode, and an additional mode \dsd{l} with
%% $(\otimes,1)$ for non-modal truth.  We assume that the relation ($i \le
%% j \cup (\forall k, \dsd{l} \le k)$ is the reflexive, transitive closure
%% of a simple graph, and add a context descriptor $\oftp{x :
%%   \dsd{j}}{\dsd{ji}(x)}{i}$ for each edge of this graph, with equations
%% $\alpha \deq \beta$ when $\alpha$ and $\beta$ both correspond to paths
%% between the same two nodes in the graph.  Then the subexponential $!_i
%% A$ is defined to be $\F{\alpha} {x : \U{x.\alpha}{\cdot}{A}}$ for the
%% $\oftp{x : i}{\alpha}{\dsd{l}}$.

\subsection{Monads}

Consider a \Dia{}{A} modality with rules in the style of
\citet{pfenningdavies}: 
\[
\infer{\Gamma \vdash \possj{A}}
      {\Gamma \vdash \truej{A}}
\qquad
\infer{\Gamma \vdash \truej{\Dia{}{A}}}
      {\Gamma \vdash \possj{A}}
\qquad
\infer{\Gamma,\truej{\Dia{}{A}} \vdash \possj{C}}
      {\truej{A} \vdash \possj{C}}
\]

We can model this using a mode theory with two modes \dsd{t} and \dsd{p}
and context descriptor \oftp{x:\dsd{t}}{\dsd{g}(x)}{\dsd{p}}, defining
the type $\Dia{}{A} :=
\U{c.\dsd{g}(c)}{\cdot}{\F{\dsd{g}(x)}{x:A}}$.  This is always a monad,
but it does not automatically have a tensorial strength, which
corresponds to the context-clearing in the left rule.

For example, if we have a monoid $(\otimes_\dsd{t},1_{\dsd t})$ on mode
\dsd{t} and try to derive
\begin{small}
\[
\infer[\UR]
      {\seq{x : A, y : \Dia{\dsd{g}}{B}}{x \otimes_{\dsd t} y}{\Dia{\dsd{g}}{(A \otimes_{\dsd t} B)}}}
      {\infer[\UL]
        {\seq{x : A, y : \Dia{\dsd{g}}{B}}{\dsd{g}(x \otimes_{\dsd t} y)}{\F{\dsd{g}}{A \otimes_{\dsd t} B}}}
        {\dsd{g}(x \otimes_{\dsd t} y) \spr \subst{\beta'}{\dsd{g}(y)}{z} &
          \seq{x:A,y : \Dia{\dsd{g}}{B},z:\F{\dsd{g}}{B}}{\beta'}{\F{\dsd{g}}{A \otimes_{\dsd t} B}}
        }}
\]
\end{small}%

\noindent we are stuck, because there is no way to rewrite $\dsd{g}(x
\otimes_{\dsd t} y)$ as a term containing $\dsd{g}(y)$.  If
$(\otimes_t,1_t)$ is affine, then we can weaken away $x$ and take
$\beta' = z$---the context-clearing in the left rule---but then in
the right-hand premise we will only have access to $z$, not $x$, so we
cannot complete the derivation.

In general, we translate all types at mode \dsd{t}, representing
\Dia{}{A} as above. We translate $\truej{A_1}, \ldots,
\truej{A_1} \vdash \truej{C}$ by our sequent
\seq{x_1:A_1^*,\ldots,x_1:A_n^*}{x_1\otimes\ldots\otimes x_n}{C^*}, and the
sequent $\truej{A_1}, \ldots, \truej{A_b} \vdash \possj{C}$ by the
\dsd{p}-conclusioned sequent
\seq{x_1:A_1^*,\ldots,x_1:A_n^*}{\dsd{g}(x_1\otimes\ldots\otimes
  x_n)}{\F{\dsd{g}}{C^*}}.  Then the three ``native'' rules above are
\FR, \UR, and a composite of \UL\/ followed by \FL, respectively.

\newcommand\ttp[2]{#1 \otimes_{\dsd {tp}} #2}
\newcommand\tvp[2]{#1 \otimes_{\dsd {vp}} #2}

Some monads, such as the \Crc{}{A} of \citep{pfenningdavies} and those
used to encapsulate effects in functional programming, do have a strength.  
One way to axiomatize the strength is via an asymmetric product of a
\dsd{t}- and \dsd{p}-mode context:
\[
\begin{array}{ll}
\oftp{x : \dsd{t}, y : \dsd{p}}{\ttp x y}{\dsd{p}}
& \dsd{g}(x \otimes_{\dsd t} y) \deq \ttp x {\dsd{g}(y)}\\
\ttp {(x \otimes_{\dsd t} y)} z \deq \ttp x {(\ttp y z)}
& \ttp {\dsd{1}} y \deq y
\end{array}
\]
The equations make this into a monoid action of the \dsd{t}-contexts on
the \dsd{p}-contexts, and allow for ``isolating'' any one $x_i$ in
$\dsd{g}(x_1 \otimes_{\dsd t} \ldots \otimes_{\dsd t} x_n)$ as the
designated variable under a \dsd{g}.  Using this (and switching notation
from \Dia{\dsd{g}}{A} to \Crc{\dsd{g}}{A}), we can prove

\begin{footnotesize}
\[
\infer[\UR]
      {\seq{x : A, y : \Crc{\dsd{g}}{B}}{x \otimes_{\dsd t} y}{\Crc{\dsd{g}}{(A \otimes_{\dsd t} B)}}}
      {\infer[\UL]
        {\seq{x : A, y : \Crc{\dsd{g}}{B}}{\dsd{g}(x \otimes_{\dsd t} y)}{\F{\dsd{g}}{A \otimes_{\dsd t} B}}}
        {\dsd{g}(x \otimes_{\dsd t} y) \spr \subst{(\ttp x z)}{\dsd{g}(y)}{z} &
          \infer[\FL]
                {\seq{x:A,y : \Crc{\dsd{g}}{B},z:\F{\dsd{g}}{B}}{\ttp x z}{\F{\dsd{g}}{A \otimes_{\dsd t} B}}}
                {\infer[\UL]
                       {\seq{x:A,y : \Crc{\dsd{g}}{B},z':B}{\ttp{x}{\dsd{g}(z')}}{\F{\dsd{g}}{A \otimes_{\dsd t} B}}}
                       { {\ttp{x}{\dsd{g}(z')}} \spr \dsd{g}(x \otimes_{\dsd t} z') & 
                         \infer[\FR]{\seq{\ldots}{x \otimes_{\dsd t} z'}{{A \otimes_{\dsd t} B}}}{}
                       }
        }}}
\]
\end{footnotesize}%


An analogous description can be given for the ``$\Box$-strong
$\Diamond$''~\citep{pfenningdavies,alechina+01categoricals4}, which has
a strength only for boxed formulas ($\Bx{} A \otimes \Dia{} B \vdash
\Dia{}(\Bx{} A \otimes B)$).  We use 3 modes \dsd{v},\dsd{t},\dsd{p} and
represent the $\Box$ as the comonad of a context descriptor
\oftp{x:\dsd{v}}{\dsd{f}(x)}{\dsd{t}} (with cartesian monoids
on \dsd{v} and \dsd{t} and \dsd{f} laxly monoidal as above), and the
$\Diamond$ as the monad of a \oftp{x:\dsd{t}}{\dsd{g}(x)}{\dsd{p}}.  We
have a mixed-mode product between \dsd{v} and \dsd{p}
\[
\begin{array}{ll}
\oftp{x : \dsd{v}, y : \dsd{p}}{\tvp x y}{\dsd{p}}
& \dsd{g}(\dsd{f}(x) \times_{\dsd t} y) \deq \tvp x {\dsd{g}(y)}\\
\ttp {(x \times_{\dsd v} y)} z \deq \ttp x {\tvp y z}
& \tvp {\dsd{1}} y \deq y
\end{array}
\]

We represent the truth-conclusioned sequent as in
Example~\ref{sec:example:box}, and $x_1:A_1 \dsd{valid},\ldots;y_1:B_1
\dsd{true},\ldots \vdash C \, \dsd{poss}$ by
\[
\seq{x_1:\Uempty{\dsd{f}}{A_1},\ldots,y_1:B_1,\ldots}
    {\dsd{g}(\dsd{f}(x_1) \times_{\dsd t} \dsd{f}(x_2) \times_{\dsd t} \ldots y_1 \times_{\dsd t} \ldots )}
    {\F{\dsd{g}}{C}}
\]
The left rule
\[
\infer{\Delta ; \Gamma, \truej{z:\Dia{}{A}} \vdash \possj C}
      {\Delta ; w':\truej A \vdash \possj C}
\]
that keeps the valid assumptions and discards the true ones is derivable
by
\begin{footnotesize}
\[
\infer%[\UL]
      {\seq{x_i:\Uempty{\dsd{f}}{A_i},y_i:B_i,z:\Dia{\dsd{g}}{A}}{\dsd{g}(\dsd{f}{(x_i)} \times y_i \times z)}{\F{\dsd{f}}{C}}}
      {
        \dsd{g}(\dsd{f}{(x_i)} \times y_i \times z) \spr \tvp{(x_1 \times_v \ldots x_n)} {\dsd{g}(z)} & 
        \infer%[\FL]
            {\seq{\ldots,w:\F{\dsd{g}}{A}}{(\tvp{(x_1 \times_v \ldots_v \times x_n)} {w})}{{\F{\dsd{f}}{C}}}}
            {\seq{\ldots,w':A}{(\tvp{(x_1 \times_v \ldots \times_v x_n)} {\dsd{g}(w')})}{{\F{\dsd{f}}{C}}}}
      }
\]
\end{footnotesize}
\noindent The transformation is given by weakening away $y_i$ and
using the monoidalness of \dsd{f} and the isolation equation:
\[
\begin{array}{ll}
& \dsd{g}(\dsd{f}(x_1) \times \ldots \times \dsd{f}(x_n) \times y_1 \times \ldots \times z)\\
\spr & \dsd{g}(\dsd{f}(x_1) \times \ldots \times \dsd{f}(x_n) \times z)\\
\deq & \dsd{g}(\dsd{f}(x_1 \times_v x_n) \times z)\\
\deq & \tvp {(x_1 \times_v x_n)} z
\end{array}
\]
The right-hand premise is the encoding of the premise of the rule, using
the isolation equation and monoidalness of \dsd{f} in the other
direction.  The restriction of the isolation equation to \dsd{f}
prevents keeping any additional \dsd{true}\/ variables in the premise.

\subsection{Spatial Type Theory}

The spatial type theory for cohesion~\citep{shulman15realcohesion}
(which motivated this work) has an adjoint pair $\flat \la \sharp$,
where $\flat$ is a comonad and $\sharp$ is a monad, with some additional
properties.  In the one-variable case~\citep{ls16adjoint}, we analyzed
this as arising from an idempotent comonad\footnote{There it was an
  idempotent monad; the variance of \dsd{F} and \dsd{U} has been flipped
  in paper.} in the mode theory: we have a mode \dsd{c} with a cartesian
monoid $(\times,\top)$ and a context descriptor
\oftp{x:\dsd{c}}{\dsd{r}(x)}{\dsd{c}} such that $\dsd{r}(\dsd{r}(x))
\deq \dsd{r}(x)$ and there is a directed transformation $\dsd{r}(x) \spr
x$.  Then we define $\flat A := \F{\dsd{r}}{A}$ and $\sharp A :=
\Uempty{\dsd{r}}{A}$. These are adjoint as discussed in
Example~\ref{sec:example:bang}, and the transformation gives the counit
$\F{\dsd{r}}{A} \vdash A$ and the unit $A \vdash \Uempty{\dsd{r}}{A}$ by
Lemma~\ref{lem:typespr}.  Now that we have a multi-assumptioned logic,
we can model the fact that $\flat{A}$ preserves products by the 
equational axiom $\dsd{r}(x \times y) \deq \dsd{r}(x) \times \dsd{r}(y)$.
Overall, we encode a simply-typed spatial type theory judgement $x_1 :
\crispj{A_1},\ldots;y_1:\cohesivej{B_1} \vdash \cohesivej{C}$ as
$\seq{x_1:A_1,\ldots,y_1:B_1,\ldots}{\dsd{r}(x_1)\times\ldots\times
  y_1\times\ldots}{C}$.  

As a sequent calculus, the rules from~\citep{shulman15realcohesion} are
\begin{footnotesize}
\[
\begin{array}{c}
\infer{\Delta;\Gamma \vdash C}
      {A \in \Delta &
       \Delta;\Gamma,A \vdash C}
\quad
\infer{\Delta; \Gamma \vdash {\Flat A}}
      {\Delta; \cdot \vdash {A}}
\quad
\infer{\Delta; \Gamma,\Flat{A} \vdash C}
      {\Delta,A; \Gamma \vdash C}
\quad
\infer{\Delta;\Gamma \vdash {\Sharp C}}
      {\Delta,\Gamma; \cdot \vdash C}
\quad
\infer{\Delta;\Gamma \vdash C}
      {\Sharp A \in \Delta &
        \Delta;\Gamma,A \vdash {C}}
\quad
\end{array}
\]
\end{footnotesize}%

\noindent In order, these correspond to (1) the action of the
contraction and $\dsd{r}(x) \spr x$ transformations; (2) \FR\/ with
weakening, using monoidalness of \dsd{r} in one direction; (3) \FL; (4)
\UR, using monoidalness of \dsd{r} in the other direction and
idempotence; (5) \UL, with contraction.  This provides a satisfying
explanation for the unusual features of these rules, such as promoting
all cohesive variables to crisp in \Sharp{}-right, and eliminating a
crisp \Sharp{} in \Sharp{}-left.  
